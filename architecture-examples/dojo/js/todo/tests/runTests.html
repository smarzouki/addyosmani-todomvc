<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!--
	This is a test runner for Dojo version of TodoMVC.
	To use this, place todomvc directory at the directory containing dojo/dijit/dojox.
-->
<html>
	<head>
		<title>Unit Test Runner</title>
		<script>
			function onLoadHandler(){
				var queryString = window.location.search.substr(1), queries = queryString.split("&"), moduleFound = false;
				for(var i = 0; i < queries.length; i++){
					if(/^test(|Url|Module)=/i.test(queries[i])){
						moduleFound = true;
						break;
					}
				}
				if(!moduleFound){
					queryString += (queryString ? "&" : "") + "test=todo/tests/module&async=true";
				}
				document.getElementById("testFrame").src = "../../../../../../util/doh/runner.html?boot=../../todomvc/architecture-examples/dojo/js/todo/tests/dojoConfig.js" + (queryString ? ("&" + queryString) : "");
			}

			function iFrameOnLoadHandler(){
				// summary:
				//		Makes sure todo/tests/dojoConfig.js is loaded before dojo.js is loaded.
				//		DOH's &boot URL arg handler does not allow us to specify what order the modules are loaded.

				var w = document.getElementById("testFrame").contentWindow, found = false;
				for(var packs = (w.require || {}).packages, i = 0; packs && i < packs.length; i++){
					if(packs[i].name == "todo"){
						found = true;
						break;
					}
				}
				if(!found){
					return setTimeout(iFrameOnLoadHandler, 500);
				}
				var script = document.createElement("script");
				script.type = "text/javascript";
				script.src = "../../../../../../dojo/dojo.js";
				script.charset = "utf-8";
				w.document.getElementsByTagName("head")[0].appendChild(script);
			}
		</script>
	</head>
	<body onload="onLoadHandler();" style="width:100%;height:100%;margin:0;padding:0;">
		<iframe id="testFrame" onload="iFrameOnLoadHandler();" frameborder="0" style="width:100%;height:100%;margin:0;padding:0;"></iframe>
	</body>
</html>
