// Generated by CoffeeScript 1.3.1
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T=[].slice,U={}.hasOwnProperty,V=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},W=function(a,b){function d(){this.constructor=a}for(var c in b)U.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},X=function(a,b){return function(){return a.apply(b,arguments)}};E=function(){var a;return a=1<=arguments.length?T.call(arguments,0):[],function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b),f=typeof e;return f=="object"||f=="function"?e||d:d}(E.Object,a,function(){})},E.version="0.8.0",E.config={pathPrefix:"/",usePushState:!1},E.container=typeof exports!="undefined"&&exports!==null?(module.exports=E,global):(window.Batman=E,window),E.typeOf=A=function(a){return typeof a=="undefined"?"Undefined":R.call(a).slice(8,-1)},R=Object.prototype.toString,E.mixin=o=function(){var a,b,c,d,e,f,g,h;e=arguments[0],d=2<=arguments.length?T.call(arguments,1):[],a=typeof e.set=="function";for(g=0,h=d.length;g<h;g++){c=d[g];if(A(c)!=="Object")continue;for(b in c){if(!U.call(c,b))continue;f=c[b];if(b==="initialize"||b==="uninitialize"||b==="prototype")continue;a?e.set(b,f):e.nodeName!=null?E.data(e,b,f):e[b]=f}typeof c.initialize=="function"&&c.initialize.call(e)}return e},E.unmixin=D=function(){var a,b,c,d,e,f;a=arguments[0],d=2<=arguments.length?T.call(arguments,1):[];for(e=0,f=d.length;e<f;e++){c=d[e];for(b in c){if(b==="initialize"||b==="uninitialize")continue;delete a[b]}typeof c.uninitialize=="function"&&c.uninitialize.call(a)}return a},E._functionName=i=function(a){var b;return a.__name__?a.__name__:a.name?a.name:(b=a.toString().match(/\W*function\s+([\w\$]+)\(/))!=null?b[1]:void 0},E._isChildOf=n=function(a,b){var c;c=b.parentNode;while(c){if(c===a)return!0;c=c.parentNode}return!1},v=c=null,Q=function(a){var b,d,e,f,g,h,i;return b=function(){var b,c;return a.postMessage?(b=!0,c=a.onmessage,a.onmessage=function(){return b=!1},a.postMessage("","*"),a.onmessage=c,b):!1},i=new E.SimpleHash,d=0,f=function(){return"go"+ ++d},a.setImmediate?(v=a.setImmediate,c=a.clearImmediate):a.msSetImmediate?(v=msSetImmediate,c=msClearImmediate):b()?(h="com.batman.",e=new E.SimpleHash,g=function(a){var b,c;if(!~a.data.search(h))return;return b=a.data.substring(h.length),typeof (c=i.unset(b))=="function"?c():void 0},a.addEventListener?a.addEventListener("message",g,!1):a.attachEvent("onmessage",g),v=function(b){var c;return i.set(c=f(),b),a.postMessage(h+c,"*"),c},c=function(a){return i.unset(a)}):typeof document!="undefined"&&V.call(document.createElement("script"),"onreadystatechange")>=0?(v=function(a){var b,c;return b=f(),c=document.createElement("script"),c.onreadystatechange=function(){var a;return typeof (a=i.get(b))=="function"&&a(),c.onreadystatechange=null,c.parentNode.removeChild(c),c=null},document.documentElement.appendChild(c),b},c=function(a){return i.unset(a)}):(v=function(a){return setTimeout(a,0)},c=function(a){return clearTimeout(a)}),E.setImmediate=v,E.clearImmediate=c},E.setImmediate=v=function(){return Q(E.container),E.setImmediate.apply(this,arguments)},E.clearImmediate=c=function(){return Q(E.container),E.clearImmediate.apply(this,arguments)},E.forEach=g=function(a,b,c){var d,e,f,g,h,i,j,k;if(a.forEach)return a.forEach(b,c);if(a.indexOf){j=[];for(e=h=0,i=a.length;h<i;e=++h)d=a[e],j.push(b.call(c,d,e,a));return j}k=[];for(f in a)g=a[f],k.push(b.call(c,f,g,a));return k},E.objectHasKey=p=function(a,b){return typeof a.hasKey=="function"?a.hasKey(b):b in a},E.contains=d=function(a,b){return a.indexOf?V.call(a,b)>=0:typeof a.has=="function"?a.has(b):p(a,b)},E.get=j=function(a,b){return typeof a.get=="function"?a.get(b):E.Property.forBaseAndKey(a,b).getValue()},E.getPath=k=function(a,b){var c,d,e;for(d=0,e=b.length;d<e;d++){c=b[d];if(a==null||(a=j(a,c))==null)return}return a},E.escapeHTML=e=function(){var a;return a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","'":"&#39;"},function(b){return(""+b).replace(/[&<>'"]/g,function(b){return a[b]})}}(),E.translate=function(a,b){return b==null&&(b={}),L.interpolate(j(E.translate.messages,a),b)},E.translate.messages={},M=function(){return E.translate.apply(E,arguments)},E.developer={suppressed:!1,DevelopmentError:function(){var a;return a=function(a){return this.message=a,this.name="DevelopmentError"},a.prototype=Error.prototype,a}(),_ie_console:function(a,b){var c,d,e,f;b.length!==1&&typeof console!="undefined"&&console!==null&&console[a]("..."+a+" of "+b.length+" items..."),f=[];for(d=0,e=b.length;d<e;d++)c=b[d],f.push(typeof console!="undefined"&&console!==null?console[a](c):void 0);return f},suppress:function(a){K.suppressed=!0;if(a)return a(),K.suppressed=!1},unsuppress:function(){return K.suppressed=!1},log:function(){if(K.suppressed||(typeof console!=="undefined"&&console!==null?console.log:void 0)==null)return;return console.log.apply?console.log.apply(console,arguments):K._ie_console("log",arguments)},warn:function(){if(K.suppressed||(typeof console!=="undefined"&&console!==null?console.warn:void 0)==null)return;return console.warn.apply?console.warn.apply(console,arguments):K._ie_console("warn",arguments)},error:function(a){throw new K.DevelopmentError(a)},assert:function(a,b){if(!a)return K.error(b)},"do":function(a){if(!K.suppressed)return a()},addFilters:function(){return o(E.Filters,{log:function(a,b){return typeof console!="undefined"&&console!==null&&typeof console.log=="function"&&console.log(arguments),a},logStack:function(a){return typeof console!="undefined"&&console!==null&&typeof console.log=="function"&&console.log(K.currentFilterStack),a}})}},K=E.developer,K.assert(function(){}.bind,"Error! Batman needs Function.bind to work! Please shim it using something like es5-shim or augmentjs!"),E.Inflector=function(){function a(){}return a.name="Inflector",a.prototype.plural=[],a.prototype.singular=[],a.prototype.uncountable=[],a.plural=function(a,b){return this.prototype.plural.unshift([a,b])},a.singular=function(a,b){return this.prototype.singular.unshift([a,b])},a.irregular=function(a,b){return a.charAt(0)===b.charAt(0)?(this.plural(new RegExp("("+a.charAt(0)+")"+a.slice(1)+"$","i"),"$1"+b.slice(1)),this.plural(new RegExp("("+a.charAt(0)+")"+b.slice(1)+"$","i"),"$1"+b.slice(1)),this.singular(new RegExp("("+b.charAt(0)+")"+b.slice(1)+"$","i"),"$1"+a.slice(1))):(this.plural(new RegExp(""+a+"$","i"),b),this.plural(new RegExp(""+b+"$","i"),b),this.singular(new RegExp(""+b+"$","i"),a))},a.uncountable=function(){var a;return a=1<=arguments.length?T.call(arguments,0):[],this.prototype.uncountable=this.prototype.uncountable.concat(a.map(function(a){return new RegExp(""+a+"$","i")}))},a.plural(/$/,"s"),a.plural(/s$/i,"s"),a.plural(/(ax|test)is$/i,"$1es"),a.plural(/(octop|vir)us$/i,"$1i"),a.plural(/(octop|vir)i$/i,"$1i"),a.plural(/(alias|status)$/i,"$1es"),a.plural(/(bu)s$/i,"$1ses"),a.plural(/(buffal|tomat)o$/i,"$1oes"),a.plural(/([ti])um$/i,"$1a"),a.plural(/([ti])a$/i,"$1a"),a.plural(/sis$/i,"ses"),a.plural(/(?:([^f])fe|([lr])f)$/i,"$1$2ves"),a.plural(/(hive)$/i,"$1s"),a.plural(/([^aeiouy]|qu)y$/i,"$1ies"),a.plural(/(x|ch|ss|sh)$/i,"$1es"),a.plural(/(matr|vert|ind)(?:ix|ex)$/i,"$1ices"),a.plural(/([m|l])ouse$/i,"$1ice"),a.plural(/([m|l])ice$/i,"$1ice"),a.plural(/^(ox)$/i,"$1en"),a.plural(/^(oxen)$/i,"$1"),a.plural(/(quiz)$/i,"$1zes"),a.singular(/s$/i,""),a.singular(/(n)ews$/i,"$1ews"),a.singular(/([ti])a$/i,"$1um"),a.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1$2sis"),a.singular(/(^analy)ses$/i,"$1sis"),a.singular(/([^f])ves$/i,"$1fe"),a.singular(/(hive)s$/i,"$1"),a.singular(/(tive)s$/i,"$1"),a.singular(/([lr])ves$/i,"$1f"),a.singular(/([^aeiouy]|qu)ies$/i,"$1y"),a.singular(/(s)eries$/i,"$1eries"),a.singular(/(m)ovies$/i,"$1ovie"),a.singular(/(x|ch|ss|sh)es$/i,"$1"),a.singular(/([m|l])ice$/i,"$1ouse"),a.singular(/(bus)es$/i,"$1"),a.singular(/(o)es$/i,"$1"),a.singular(/(shoe)s$/i,"$1"),a.singular(/(cris|ax|test)es$/i,"$1is"),a.singular(/(octop|vir)i$/i,"$1us"),a.singular(/(alias|status)es$/i,"$1"),a.singular(/^(ox)en/i,"$1"),a.singular(/(vert|ind)ices$/i,"$1ex"),a.singular(/(matr)ices$/i,"$1ix"),a.singular(/(quiz)zes$/i,"$1"),a.singular(/(database)s$/i,"$1"),a.irregular("person","people"),a.irregular("man","men"),a.irregular("child","children"),a.irregular("sex","sexes"),a.irregular("move","moves"),a.irregular("cow","kine"),a.irregular("zombie","zombies"),a.uncountable("equipment","information","rice","money","species","series","fish","sheep","jeans"),a.prototype.ordinalize=function(a){var b,c;b=Math.abs(parseInt(a));if(c=b%100,V.call([11,12,13],c)>=0)return a+"th";switch(b%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd";default:return a+"th"}},a.prototype.pluralize=function(a){var b,c,d,e,f,g,h,i,j,k;i=this.uncountable;for(e=0,g=i.length;e<g;e++){d=i[e];if(d.test(a))return a}j=this.plural;for(f=0,h=j.length;f<h;f++){k=j[f],b=k[0],c=k[1];if(b.test(a))return a.replace(b,c)}return a},a.prototype.singularize=function(a){var b,c,d,e,f,g,h,i,j,k;i=this.uncountable;for(e=0,g=i.length;e<g;e++){d=i[e];if(d.test(a))return a}j=this.singular;for(f=0,h=j.length;f<h;f++){k=j[f],b=k[0],c=k[1];if(b.test(a))return a.replace(b,c)}return a},a}(),I=/(?:^|_|\-)(.)/g,J=/(^|\s)([a-z])/g,N=/([A-Z]+)([A-Z][a-z])/g,O=/([a-z\d])([A-Z])/g,L=E.helpers={inflector:new E.Inflector,ordinalize:function(){return L.inflector.ordinalize.apply(L.inflector,arguments)},singularize:function(){return L.inflector.singularize.apply(L.inflector,arguments)},pluralize:function(a,b,c){return arguments.length<2?L.inflector.pluralize(a):""+(a||0)+" "+(+a===1?b:c||L.inflector.pluralize(b))},camelize:function(a,b){return a=a.replace(I,function(a,b){return b.toUpperCase()}),b?a.substr(0,1).toLowerCase()+a.substr(1):a},underscore:function(a){return a.replace(N,"$1_$2").replace(O,"$1_$2").replace("-","_").toLowerCase()},capitalize:function(a){return a.replace(J,function(a,b,c){return b+c.toUpperCase()})},trim:function(a){return a?a.trim():""},interpolate:function(a,b){var c,d,e;typeof a=="object"?(d=a[b.count],d||(d=a.other)):d=a;for(c in b)e=b[c],d=d.replace(new RegExp("%\\{"+c+"\\}","g"),e);return d}},E.Event=function(){function a(a,b){this.base=a,this.key=b,this.handlers=[],this._preventCount=0}return a.name="Event",a.forBaseAndKey=function(a,b){return a.isEventEmitter?a.event(b):new E.Event(a,b)},a.prototype.isEvent=!0,a.prototype.isEqual=function(a){return this.constructor===a.constructor&&this.base===a.base&&this.key===a.key},a.prototype.hashKey=function(){var a;return this.hashKey=function(){return a},a="<Batman.Event base: "+E.Hash.prototype.hashKeyFor(this.base)+', key: "'+E.Hash.prototype.hashKeyFor(this.key)+'">'},a.prototype.addHandler=function(a){return this.handlers.indexOf(a)===-1&&this.handlers.push(a),this.oneShot&&this.autofireHandler(a),this},a.prototype.removeHandler=function(a){var b;return(b=this.handlers.indexOf(a))!==-1&&this.handlers.splice(b,1),this},a.prototype.eachHandler=function(a){var b,c,d;this.handlers.slice().forEach(a);if((c=this.base)!=null?c.isEventEmitter:void 0)return b=this.key,(d=this.base._batman)!=null?d.ancestors(function(c){var d,e,f;if(c.isEventEmitter&&((e=c._batman)!=null?(f=e.events)!=null?f.hasOwnProperty(b):void 0:void 0))return d=c.event(b).handlers,d.slice().forEach(a)}):void 0},a.prototype.clearHandlers=function(){return this.handlers=[]},a.prototype.handlerContext=function(){return this.base},a.prototype.prevent=function(){return++this._preventCount},a.prototype.allow=function(){return this._preventCount&&--this._preventCount,this._preventCount},a.prototype.isPrevented=function(){return this._preventCount>0},a.prototype.autofireHandler=function(a){if(this._oneShotFired&&this._oneShotArgs!=null)return a.apply(this.handlerContext(),this._oneShotArgs)},a.prototype.resetOneShot=function(){return this._oneShotFired=!1,this._oneShotArgs=null},a.prototype.fire=function(){var a,b;return this.isPrevented()||this._oneShotFired?!1:(b=this.handlerContext(),a=arguments,this.oneShot&&(this._oneShotFired=!0,this._oneShotArgs=arguments),this.eachHandler(function(c){return c.apply(b,a)}))},a.prototype.allowAndFire=function(){return this.allow(),this.fire.apply(this,arguments)},a}(),E.EventEmitter={isEventEmitter:!0,hasEvent:function(a){var b,c;return(b=this._batman)!=null?typeof b.get=="function"?(c=b.get("events"))!=null?c.hasOwnProperty(a):void 0:void 0:void 0},event:function(a){var b,c,d,e,f;return E.initializeObject(this),b=this.eventClass||E.Event,c=(f=this._batman).events||(f.events={}),c.hasOwnProperty(a)?d=c[a]:(this._batman.ancestors(function(b){var c,e;return d||(d=(c=b._batman)!=null?(e=c.events)!=null?e[a]:void 0:void 0)}),e=c[a]=new b(this,a),e.oneShot=d!=null?d.oneShot:void 0,e)},on:function(a,b){return this.event(a).addHandler(b)},once:function(a,b){var c,d;return c=this.event(a),d=function(){return b.apply(this,arguments),c.removeHandler(d)},c.addHandler(d)},registerAsMutableSource:function(){return E.Property.registerSource(this)},mutation:function(a){return function(){var b;return b=a.apply(this,arguments),this.event("change").fire(this,this),b}},prevent:function(a){return this.event(a).prevent(),this},allow:function(a){return this.event(a).allow(),this},isPrevented:function(a){return this.event(a).isPrevented()},fire:function(){var a,b,c;return b=arguments[0],a=2<=arguments.length?T.call(arguments,1):[],(c=this.event(b)).fire.apply(c,a)},allowAndFire:function(){var a,b,c;return b=arguments[0],a=2<=arguments.length?T.call(arguments,1):[],(c=this.event(b)).allowAndFire.apply(c,a)}},E.PropertyEvent=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="PropertyEvent",b.prototype.eachHandler=function(a){return this.base.eachObserver(a)},b.prototype.handlerContext=function(){return this.base.base},b}(E.Event),E.Property=function(){function a(a,b){var c=this;this.base=a,this.key=b,K["do"](function(){var a;a=A(c.key);if(a==="Array"||a==="Object")return K.log("Accessing a property with an "+a+" key. This is okay, but could be a source of memory leaks if you aren't careful.")})}return a.name="Property",o(a.prototype,E.EventEmitter),a._sourceTrackerStack=[],a.sourceTracker=function(){var a;return(a=this._sourceTrackerStack)[a.length-1]},a.defaultAccessor={get:function(a){return this[a]},set:function(a,b){return this[a]=b},unset:function(a){var b;return b=this[a],delete this[a],b},cachable:!1},a.defaultAccessorForBase=function(a){var b;return((b=a._batman)!=null?b.getFirst("defaultAccessor"):void 0)||E.Property.defaultAccessor},a.accessorForBaseAndKey=function(a,b){var c,d,e,f=this;return(d=a._batman)!=null&&(c=(e=d.keyAccessors)!=null?e.get(b):void 0,c||d.ancestors(function(a){var d,e;return c||(c=(d=a._batman)!=null?(e=d.keyAccessors)!=null?e.get(b):void 0:void 0)})),c||this.defaultAccessorForBase(a)},a.forBaseAndKey=function(a,b){return a.isObservable?a.property(b):new E.Keypath(a,b)},a.withoutTracking=function(a){this.pushDummySourceTracker();try{return a()}finally{this.popSourceTracker()}},a.registerSource=function(a){var b;if(!a.isEventEmitter)return;return(b=this.sourceTracker())!=null?b.add(a):void 0},a.pushSourceTracker=function(){return E.Property._sourceTrackerStack.push(new E.SimpleSet)},a.pushDummySourceTracker=function(){return E.Property._sourceTrackerStack.push(null)},a.popSourceTracker=function(){return E.Property._sourceTrackerStack.pop()},a.prototype._isolationCount=0,a.prototype.cached=!1,a.prototype.value=null,a.prototype.sources=null,a.prototype.isProperty=!0,a.prototype.isDead=!1,a.prototype.eventClass=E.PropertyEvent,a.prototype.isEqual=function(a){return this.constructor===a.constructor&&this.base===a.base&&this.key===a.key},a.prototype.hashKey=function(){var a;return this.hashKey=function(){return a},a="<Batman.Property base: "+E.Hash.prototype.hashKeyFor(this.base)+', key: "'+E.Hash.prototype.hashKeyFor(this.key)+'">'},a.prototype.event=function(a){var b,c;return b=this.eventClass||E.Event,this.events||(this.events={}),(c=this.events)[a]||(c[a]=new b(this,a)),this.events[a]},a.prototype.changeEvent=function(){var a;return a=this.event("change"),this.changeEvent=function(){return a},a},a.prototype.accessor=function(){var a;return a=this.constructor.accessorForBaseAndKey(this.base,this.key),this.accessor=function(){return a},a},a.prototype.eachObserver=function(a){var b;b=this.key,this.changeEvent().handlers.slice().forEach(a);if(this.base.isObservable)return this.base._batman.ancestors(function(c){var d,e;if(c.isObservable&&c.hasProperty(b))return e=c.property(b),d=e.changeEvent().handlers,d.slice().forEach(a)})},a.prototype.observers=function(){var a;return a=[],this.eachObserver(function(b){return a.push(b)}),a},a.prototype.hasObservers=function(){return this.observers().length>0},a.prototype.updateSourcesFromTracker=function(){var a,b;return b=this.constructor.popSourceTracker(),a=this.sourceChangeHandler(),this._eachSourceChangeEvent(function(b){return b.removeHandler(a)}),this.sources=b,this._eachSourceChangeEvent(function(b){return b.addHandler(a)})},a.prototype._eachSourceChangeEvent=function(a){if(this.sources==null)return;return this.sources.forEach(function(b){return a(b.event("change"))})},a.prototype.getValue=function(){this.registerAsMutableSource();if(!this.isCached()){this.constructor.pushSourceTracker();try{this.value=this.valueFromAccessor(),this.cached=!0}finally{this.updateSourcesFromTracker()}}return this.value},a.prototype.isCachable=function(){var a;return this.isFinal()?!0:(a=this.accessor().cachable,a!=null?!!a:!0)},a.prototype.isCached=function(){return this.isCachable()&&this.cached},a.prototype.isFinal=function(){return!!this.accessor()["final"]},a.prototype.refresh=function(){var a,b;this.cached=!1,a=this.value,b=this.getValue(),b!==a&&!this.isIsolated()&&this.fire(b,a);if(this.value!==void 0&&this.isFinal())return this.lockValue()},a.prototype.sourceChangeHandler=function(){var a;return a=this._handleSourceChange.bind(this),K["do"](function(){return a.property=this}),this.sourceChangeHandler=function(){return a},a},a.prototype._handleSourceChange=function(){return this.isIsolated()?this._needsRefresh=!0:!this.isFinal()&&!this.hasObservers()?this.cached=!1:this.refresh()},a.prototype.valueFromAccessor=function(){var a;return(a=this.accessor().get)!=null?a.call(this.base,this.key):void 0},a.prototype.setValue=function(a){var b;if(!(b=this.accessor().set))return;return this._changeValue(function(){return b.call(this.base,this.key,a)})},a.prototype.unsetValue=function(){var a;if(!(a=this.accessor().unset))return;return this._changeValue(function(){return a.call(this.base,this.key)})},a.prototype._changeValue=function(a){var b;this.cached=!1,this.constructor.pushDummySourceTracker();try{b=a.apply(this),this.refresh()}finally{this.constructor.popSourceTracker()}return!this.isCached()&&!this.hasObservers()&&this.die(),b},a.prototype.forget=function(a){return a!=null?this.changeEvent().removeHandler(a):this.changeEvent().clearHandlers()},a.prototype.observeAndFire=function(a){return this.observe(a),a.call(this.base,this.value,this.value)},a.prototype.observe=function(a){return this.changeEvent().addHandler(a),this.sources==null&&this.getValue(),this},a.prototype._removeHandlers=function(){var a;return a=this.sourceChangeHandler(),this._eachSourceChangeEvent(function(b){return b.removeHandler(a)}),delete this.sources,this.changeEvent().clearHandlers()},a.prototype.lockValue=function(){return this._removeHandlers(),this.getValue=function(){return this.value},this.setValue=this.unsetValue=this.refresh=this.observe=function(){}},a.prototype.die=function(){var a,b;return this._removeHandlers(),(a=this.base._batman)!=null&&(b=a.properties)!=null&&b.unset(this.key),this.isDead=!0},a.prototype.fire=function(){var a;return(a=this.changeEvent()).fire.apply(a,arguments)},a.prototype.isolate=function(){return this._isolationCount===0&&(this._preIsolationValue=this.getValue()),this._isolationCount++},a.prototype.expose=function(){if(this._isolationCount===1)return this._isolationCount--,this._needsRefresh?(this.value=this._preIsolationValue,this.refresh()):this.value!==this._preIsolationValue&&this.fire(this.value,this._preIsolationValue),this._preIsolationValue=null;if(this._isolationCount>0)return this._isolationCount--},a.prototype.isIsolated=function(){return this._isolationCount>0},a}(),E.Keypath=function(a){function b(a,c){typeof c=="string"?(this.segments=c.split("."),this.depth=this.segments.length):(this.segments=[c],this.depth=1),b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="Keypath",b.prototype.terminalProperty=function(){var a;a=k(this.base,this.segments.slice(0,-1));if(a==null)return;return E.Keypath.forBaseAndKey(a,this.segments[this.depth-1])},b.prototype.valueFromAccessor=function(){return this.depth===1?b.__super__.valueFromAccessor.apply(this,arguments):k(this.base,this.segments)},b.prototype.setValue=function(a){var c;return this.depth===1?b.__super__.setValue.apply(this,arguments):(c=this.terminalProperty())!=null?c.setValue(a):void 0},b.prototype.unsetValue=function(){var a;return this.depth===1?b.__super__.unsetValue.apply(this,arguments):(a=this.terminalProperty())!=null?a.unsetValue():void 0},b}(E.Property),E.Observable={isObservable:!0,hasProperty:function(a){var b,c;return(b=this._batman)!=null?(c=b.properties)!=null?typeof c.hasKey=="function"?c.hasKey(a):void 0:void 0:void 0},property:function(a){var b,c,d;return E.initializeObject(this),c=this.propertyClass||E.Keypath,b=(d=this._batman).properties||(d.properties=new E.SimpleHash),b.get(a)||b.set(a,new c(this,a))},get:function(a){return this.property(a).getValue()},set:function(a,b){return this.property(a).setValue(b)},unset:function(a){return this.property(a).unsetValue()},getOrSet:function(a,b){var c;return c=this.get(a),c||(c=b(),this.set(a,c)),c},forget:function(a,b){var c;return a?this.property(a).forget(b):(c=this._batman.properties)!=null&&c.forEach(function(a,b){return b.forget()}),this},observe:function(){var a,b,c;return b=arguments[0],a=2<=arguments.length?T.call(arguments,1):[],(c=this.property(b)).observe.apply(c,a),this},observeAndFire:function(){var a,b,c;return b=arguments[0],a=2<=arguments.length?T.call(arguments,1):[],(c=this.property(b)).observeAndFire.apply(c,a),this}},E.initializeObject=function(a){return a._batman!=null?a._batman.check(a):a._batman=new P(a)},E._Batman=P=function(){function a(a){this.object=a}return a.name="_Batman",a.prototype.check=function(b){return b!==this.object?(b._batman=new a(b),!1):!0},a.prototype.get=function(a){var b,c;c=this.getAll(a);switch(c.length){case 0:return;case 1:return c[0];default:return b=c[0].concat!=null?function(a,b){return a.concat(b)}:c[0].merge!=null?function(a,b){return a.merge(b)}:c.every(function(a){return typeof a=="object"})?(c.unshift({}),function(a,b){return o(a,b)}):void 0,b?c.reduceRight(b):c}},a.prototype.getFirst=function(a){var b;return b=this.getAll(a),b[0]},a.prototype.getAll=function(a){var b,c,d;return typeof a=="function"?b=a:b=function(b){var c;return(c=b._batman)!=null?c[a]:void 0},c=this.ancestors(b),(d=b(this.object))&&c.unshift(d),c},a.prototype.ancestors=function(a){var b,c,d,e,f,g,h;return a==null&&(a=function(a){return a}),e=[],b=!!this.object.prototype,c=b?(g=this.object.__super__)!=null?g.constructor:void 0:(d=Object.getPrototypeOf(this.object))===this.object?this.object.constructor.__super__:d,c!=null&&((h=c._batman)!=null&&h.check(c),f=a(c),f!=null&&e.push(f),c._batman!=null&&(e=e.concat(c._batman.ancestors(a)))),e},a.prototype.set=function(a,b){return this[a]=b},a}(),F=function(a){function f(){var a;a=1<=arguments.length?T.call(arguments,0):[],this._batman=new P(this),this.mixin.apply(this,a)}var b,c,d,e;return W(f,a),f.name="BatmanObject",E.initializeObject(f),E.initializeObject(f.prototype),f.global=function(a){if(a===!1)return;return E.container[i(this)]=this},f.classMixin=function(){return o.apply(null,[this].concat(T.call(arguments)))},f.mixin=function(){return this.classMixin.apply(this.prototype,arguments)},f.prototype.mixin=f.classMixin,b=0,f.prototype._objectID=function(){var a;return this._objectID=function(){return a},a=b++},f.prototype.hashKey=function(){var a;if(typeof this.isEqual=="function")return;return this.hashKey=function(){return a},a="<Batman.Object "+this._objectID()+">"},f.prototype.toJSON=function(){var a,b,c;b={};for(a in this){if(!U.call(this,a))continue;c=this[a],a!=="_batman"&&a!=="hashKey"&&a!=="_objectID"&&(b[a]=(c!=null?c.toJSON:void 0)?c.toJSON():c)}return b},c=function(a,b){return typeof b=="function"&&(b={get:b}),b},d=function(a){return function(b){return{get:function(c){var d,e,f,g=this;return f=b.get.apply(this,arguments),typeof f!="undefined"?f:(e=!1,d=function(a,b){return e&&g.set(c,b),f=b},a.call(this,d,c),e=!0,f)},cachable:!0}}},f.classAccessor=function(){var a,b,e,f,g,h,i,j,k;e=2<=arguments.length?T.call(arguments,0,g=arguments.length-1):(g=0,[]),a=arguments[g++];if(a==null)return E.Property.defaultAccessorForBase(this);if(e.length===0&&(j=A(a))!=="Object"&&j!=="Function")return E.Property.accessorForBaseAndKey(this,a);if(typeof a.promise=="function")return this.wrapAccessor.apply(this,T.call(e).concat([d(a.promise)]));E.initializeObject(this);if(e.length===0)return this._batman.defaultAccessor=c(this,a);(f=this._batman).keyAccessors||(f.keyAccessors=new E.SimpleHash),k=[];for(h=0,i=e.length;h<i;h++)b=e[h],k.push(this._batman.keyAccessors.set(b,c(this,a)));return k},f.accessor=function(){return this.classAccessor.apply(this.prototype,arguments)},f.prototype.accessor=f.classAccessor,e=function(a,b){var c,d;b=(typeof b=="function"?b(a):void 0)||b;for(c in a)d=a[c],c in b||(b[c]=d);return b},f.wrapClassAccessor=function(){var a,b,c,d,f,g,h;b=2<=arguments.length?T.call(arguments,0,d=arguments.length-1):(d=0,[]),c=arguments[d++],E.initializeObject(this);if(b.length===0)return this.accessor(e(this.accessor(),c));h=[];for(f=0,g=b.length;f<g;f++)a=b[f],h.push(this.accessor(a,e(this.accessor(a),c)));return h},f.wrapAccessor=function(){return this.wrapClassAccessor.apply(this.prototype,arguments)},f.prototype.wrapAccessor=f.wrapClassAccessor,f.classMixin(E.EventEmitter,E.Observable),f.mixin(E.EventEmitter,E.Observable),f.observeAll=function(){return this.prototype.observe.apply(this.prototype,arguments)},f.singleton=function(a){return a==null&&(a="sharedInstance"),this.classAccessor(a,{get:function(){var b;return this[b="_"+a]||(this[b]=new this)}})},f}(Object),E.Object=F,E.Accessible=function(a){function b(){this.accessor.apply(this,arguments)}return W(b,a),b.name="Accessible",b}(E.Object),E.TerminalAccessible=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="TerminalAccessible",b.prototype.propertyClass=E.Property,b}(E.Accessible),E.Enumerable={isEnumerable:!0,map:function(a,b){var c;return b==null&&(b=E.container),c=[],this.forEach(function(){return c.push(a.apply(b,arguments))}),c},mapToProperty:function(a){var b;return b=[],this.forEach(function(c){return b.push(c.get(a))}),b},every:function(a,b){var c;return b==null&&(b=E.container),c=!0,this.forEach(function(){return c=c&&a.apply(b,arguments)}),c},some:function(a,b){var c;return b==null&&(b=E.container),c=!1,this.forEach(function(){return c=c||a.apply(b,arguments)}),c},reduce:function(a,b){var c,d;return c=0,d=this,this.forEach(function(){return b!=null?b=a.apply(null,[b].concat(T.call(arguments),[c],[d])):b=arguments[0]}),b},filter:function(a){var b,c;return b=new this.constructor,b.add?c=function(b,c){return a(c)&&b.add(c),b}:b.set?c=function(b,c,d){return a(c,d)&&b.set(c,d),b}:(b.push||(b=[]),c=function(b,c){return a(c)&&b.push(c),b}),this.reduce(c,b)}},f=function(a){var b,c,d,e;d=E.Enumerable,e=[];for(b in d)c=d[b],e.push(a[b]=c);return e},E.SimpleHash=function(){function a(a){this._storage={},this.length=0,a!=null&&this.update(a)}return a.name="SimpleHash",f(a.prototype),a.prototype.propertyClass=E.Property,a.prototype.hasKey=function(a){var b,c,d,e;if(this.objectKey(a)){if(!this._objectStorage)return!1;if(c=this._objectStorage[this.hashKeyFor(a)])for(d=0,e=c.length;d<e;d++){b=c[d];if(this.equality(b[0],a))return!0}return!1}return a=this.prefixedKey(a),this._storage.hasOwnProperty(a)},a.prototype.get=function(a){var b,c,d,e;if(!this.objectKey(a))return this._storage[this.prefixedKey(a)];if(!this._objectStorage)return;if(c=this._objectStorage[this.hashKeyFor(a)])for(d=0,e=c.length;d<e;d++){b=c[d];if(this.equality(b[0],a))return b[1]}},a.prototype.set=function(a,b){var c,d,e,f,g,h;if(this.objectKey(a)){this._objectStorage||(this._objectStorage={}),d=(e=this._objectStorage)[h=this.hashKeyFor(a)]||(e[h]=[]);for(f=0,g=d.length;f<g;f++){c=d[f];if(this.equality(c[0],a))return c[1]=b}return this.length++,d.push([a,b]),b}return a=this.prefixedKey(a),this._storage[a]==null&&this.length++,this._storage[a]=b},a.prototype.unset=function(a){var b,c,d,e,f,g,h,i,j,k;if(!this.objectKey(a))return a=this.prefixedKey(a),g=this._storage[a],this._storage[a]!=null&&(this.length--,delete this._storage[a]),g;if(!this._objectStorage)return;b=this.hashKeyFor(a);if(f=this._objectStorage[b])for(c=i=0,j=f.length;i<j;c=++i){k=f[c],d=k[0],h=k[1];if(this.equality(d,a))return e=f.splice(c,1),f.length||delete this._objectStorage[b],this.length--,e[0][1]}},a.prototype.getOrSet=E.Observable.getOrSet,a.prototype.prefixedKey=function(a){return"_"+a},a.prototype.unprefixedKey=function(a){return a.slice(1)},a.prototype.hashKeyFor=function(a){return(a!=null?typeof a.hashKey=="function"?a.hashKey():void 0:void 0)||a},a.prototype.equality=function(a,b){return a===b?!0:a!==a&&b!==b?!0:(a!=null?typeof a.isEqual=="function"?a.isEqual(b):void 0:void 0)&&(b!=null?typeof b.isEqual=="function"?b.isEqual(a):void 0:void 0)?!0:!1},a.prototype.objectKey=function(a){return typeof a!="string"},a.prototype.forEach=function(a,b){var c,d,e,f,g,h,i,j,k,l,m;e=[];if(this._objectStorage){j=this._objectStorage;for(c in j){g=j[c],k=g.slice();for(h=0,i=k.length;h<i;h++)l=k[h],d=l[0],f=l[1],e.push(a.call(b,d,f,this))}}m=this._storage;for(c in m)f=m[c],e.push(a.call(b,this.unprefixedKey(c),f,this));return e},a.prototype.keys=function(){var a;return a=[],E.SimpleHash.prototype.forEach.call(this,function(b){return a.push(b)}),a},a.prototype.clear=function(){return this._storage={},delete this._objectStorage,this.length=0},a.prototype.isEmpty=function(){return this.length===0},a.prototype.merge=function(){var a,b,c,d,e;c=1<=arguments.length?T.call(arguments,0):[],b=new this.constructor,c.unshift(this);for(d=0,e=c.length;d<e;d++)a=c[d],a.forEach(function(a,c){return b.set(a,c)});return b},a.prototype.update=function(a){var b,c,d;d=[];for(b in a)c=a[b],d.push(this.set(b,c));return d},a.prototype.replace=function(a){var b=this;return this.forEach(function(c,d){if(!(c in a))return b.unset(c)}),this.update(a)},a.prototype.toObject=function(){var a,b,c,d,e,f;b={},e=this._storage;for(a in e)d=e[a],b[this.unprefixedKey(a)]=d;if(this._objectStorage){f=this._objectStorage;for(a in f)c=f[a],b[a]=c[0][1]}return b},a.prototype.toJSON=a.prototype.toObject,a}(),E.Hash=function(a){function l(){this.meta=new this.constructor.Metadata(this),E.SimpleHash.apply(this,arguments),l.__super__.constructor.apply(this,arguments)}var b,c,d,e,g,h,i,j,k=this;W(l,a),l.name="Hash",l.Metadata=function(a){function b(a){this.hash=a}return W(b,a),b.name="Metadata",b.accessor("length",function(){return this.hash.registerAsMutableSource(),this.hash.length}),b.accessor("isEmpty",function(){return this.hash.isEmpty()}),b.accessor("keys",function(){return this.hash.keys()}),b}(E.Object),f(l.prototype),l.prototype.propertyClass=E.Property,l.accessor({get:E.SimpleHash.prototype.get,set:l.mutation(function(a,b){var c;return c=E.SimpleHash.prototype.set.call(this,a,b),this.fire("itemsWereAdded",a),c}),unset:l.mutation(function(a){var b;return b=E.SimpleHash.prototype.unset.call(this,a),b!=null&&this.fire("itemsWereRemoved",a),b}),cachable:!1}),l.prototype._preventMutationEvents=function(a){this.prevent("change"),this.prevent("itemsWereAdded"),this.prevent("itemsWereRemoved");try{return a.call(this)}finally{this.allow("change"),this.allow("itemsWereAdded"),this.allow("itemsWereRemoved")}},l.prototype.clear=l.mutation(function(){var a,b;return a=this.keys(),this._preventMutationEvents(function(){var a=this;return this.forEach(function(b){return a.unset(b)})}),b=E.SimpleHash.prototype.clear.call(this),this.fire.apply(this,["itemsWereRemoved"].concat(T.call(a))),b}),l.prototype.update=l.mutation(function(a){var b;b=[],this._preventMutationEvents(function(){var c=this;return E.forEach(a,function(a,d){return c.hasKey
(a)||b.push(a),c.set(a,d)})});if(b.length>0)return this.fire.apply(this,["itemsWereAdded"].concat(T.call(b)))}),l.prototype.replace=l.mutation(function(a){var b,c;b=[],c=[],this._preventMutationEvents(function(){var d=this;return this.forEach(function(b,e){if(!E.objectHasKey(a,b))return d.unset(b),c.push(b)}),E.forEach(a,function(a,c){return d.hasKey(a)||b.push(a),d.set(a,c)})}),b.length>0&&this.fire.apply(this,["itemsWereAdded"].concat(T.call(b)));if(c.length>0)return this.fire.apply(this,["itemsWereRemoved"].concat(T.call(c)))}),i=["equality","hashKeyFor","objectKey","prefixedKey","unprefixedKey"];for(d=0,g=i.length;d<g;d++)b=i[d],l.prototype[b]=E.SimpleHash.prototype[b];j=["hasKey","forEach","isEmpty","keys","merge","toJSON","toObject"],c=function(a){return l.prototype[a]=function(){return this.registerAsMutableSource(),E.SimpleHash.prototype[a].apply(this,arguments)}};for(e=0,h=j.length;e<h;e++)b=j[e],c(b);return l}.call(this,E.Object),E.SimpleSet=function(){function a(){this._storage=[],this.length=0,arguments.length>0&&this.add.apply(this,arguments)}return a.name="SimpleSet",f(a.prototype),a.prototype.has=function(a){return!!~this._storage.indexOf(a)},a.prototype.add=function(){var a,b,c,d,e;c=1<=arguments.length?T.call(arguments,0):[],a=[];for(d=0,e=c.length;d<e;d++){b=c[d];if(!!~this._storage.indexOf(b))continue;this._storage.push(b),a.push(b)}return this.length=this._storage.length,this.fire&&a.length!==0&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereAdded"].concat(T.call(a)))),a},a.prototype.remove=function(){var a,b,c,d,e,f;c=1<=arguments.length?T.call(arguments,0):[],d=[];for(e=0,f=c.length;e<f;e++){b=c[e];if(!~(a=this._storage.indexOf(b)))continue;this._storage.splice(a,1),d.push(b)}return this.length=this._storage.length,this.fire&&d.length!==0&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereRemoved"].concat(T.call(d)))),d},a.prototype.find=function(a){var b,c,d,e;e=this._storage;for(c=0,d=e.length;c<d;c++){b=e[c];if(a(b))return b}return},a.prototype.forEach=function(a,b){var c;return c=this,this._storage.slice().forEach(function(d){return a.call(b,d,null,c)})},a.prototype.isEmpty=function(){return this.length===0},a.prototype.clear=function(){var a;return a=this._storage,this._storage=[],this.length=0,this.fire&&a.length!==0&&(this.fire("change",this,this),this.fire.apply(this,["itemsWereRemoved"].concat(T.call(a)))),a},a.prototype.replace=function(a){try{return typeof this.prevent=="function"&&this.prevent("change"),this.clear(),this.add.apply(this,a.toArray())}finally{typeof this.allowAndFire=="function"&&this.allowAndFire("change",this,this)}},a.prototype.toArray=function(){return this._storage.slice()},a.prototype.merge=function(){var a,b,c,d,e;b=1<=arguments.length?T.call(arguments,0):[],a=new this.constructor,b.unshift(this);for(d=0,e=b.length;d<e;d++)c=b[d],c.forEach(function(b){return a.add(b)});return a},a.prototype.indexedBy=function(a){return this._indexes||(this._indexes=new E.SimpleHash),this._indexes.get(a)||this._indexes.set(a,new E.SetIndex(this,a))},a.prototype.indexedByUnique=function(a){return this._uniqueIndexes||(this._uniqueIndexes=new E.SimpleHash),this._uniqueIndexes.get(a)||this._uniqueIndexes.set(a,new E.UniqueSetIndex(this,a))},a.prototype.sortedBy=function(a,b){var c;return b==null&&(b="asc"),b=b.toLowerCase()==="desc"?"desc":"asc",this._sorts||(this._sorts=new E.SimpleHash),c=this._sorts.get(a)||this._sorts.set(a,new E.Object),c.get(b)||c.set(b,new E.SetSort(this,a,b))},a}(),E.Set=function(a){function l(){E.SimpleSet.apply(this,arguments)}var b,c,d,e,g,h,i,j,k;W(l,a),l.name="Set",f(l.prototype),l._applySetAccessors=function(a){return a.accessor("first",function(){return this.toArray()[0]}),a.accessor("last",function(){return this.toArray()[this.length-1]}),a.accessor("indexedBy",function(){var a=this;return new E.TerminalAccessible(function(b){return a.indexedBy(b)})}),a.accessor("indexedByUnique",function(){var a=this;return new E.TerminalAccessible(function(b){return a.indexedByUnique(b)})}),a.accessor("sortedBy",function(){var a=this;return new E.TerminalAccessible(function(b){return a.sortedBy(b)})}),a.accessor("sortedByDescending",function(){var a=this;return new E.TerminalAccessible(function(b){return a.sortedBy(b,"desc")})}),a.accessor("isEmpty",function(){return this.isEmpty()}),a.accessor("toArray",function(){return this.toArray()}),a.accessor("length",function(){return this.registerAsMutableSource(),this.length})},l._applySetAccessors(l),j=["add","remove","clear","replace","indexedBy","indexedByUnique","sortedBy"];for(e=0,h=j.length;e<h;e++)b=j[e],l.prototype[b]=E.SimpleSet.prototype[b];k=["find","merge","forEach","toArray","isEmpty","has"],d=function(a){return c[a]=function(){return this.registerAsMutableSource(),E.SimpleSet.prototype[a].apply(this,arguments)}};for(g=0,i=k.length;g<i;g++)b=k[g],c=l.prototype,d(b);return l.prototype.toJSON=l.prototype.toArray,l}(E.Object),E.SetObserver=function(a){function b(a){var b=this;this.base=a,this._itemObservers=new E.SimpleHash,this._setObservers=new E.SimpleHash,this._setObservers.set("itemsWereAdded",function(){return b.fire.apply(b,["itemsWereAdded"].concat(T.call(arguments)))}),this._setObservers.set("itemsWereRemoved",function(){return b.fire.apply(b,["itemsWereRemoved"].concat(T.call(arguments)))}),this.on("itemsWereAdded",this.startObservingItems.bind(this)),this.on("itemsWereRemoved",this.stopObservingItems.bind(this))}return W(b,a),b.name="SetObserver",b.prototype.observedItemKeys=[],b.prototype.observerForItemAndKey=function(a,b){},b.prototype._getOrSetObserverForItemAndKey=function(a,b){var c=this;return this._itemObservers.getOrSet(a,function(){var d;return d=new E.SimpleHash,d.getOrSet(b,function(){return c.observerForItemAndKey(a,b)})})},b.prototype.startObserving=function(){return this._manageItemObservers("observe"),this._manageSetObservers("addHandler")},b.prototype.stopObserving=function(){return this._manageItemObservers("forget"),this._manageSetObservers("removeHandler")},b.prototype.startObservingItems=function(){var a,b,c,d,e;b=1<=arguments.length?T.call(arguments,0):[],e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(this._manageObserversForItem(a,"observe"));return e},b.prototype.stopObservingItems=function(){var a,b,c,d,e;b=1<=arguments.length?T.call(arguments,0):[],e=[];for(c=0,d=b.length;c<d;c++)a=b[c],e.push(this._manageObserversForItem(a,"forget"));return e},b.prototype._manageObserversForItem=function(a,b){var c,d,e,f;if(!a.isObservable)return;f=this.observedItemKeys;for(d=0,e=f.length;d<e;d++)c=f[d],a[b](c,this._getOrSetObserverForItemAndKey(a,c));if(b==="forget")return this._itemObservers.unset(a)},b.prototype._manageItemObservers=function(a){var b=this;return this.base.forEach(function(c){return b._manageObserversForItem(c,a)})},b.prototype._manageSetObservers=function(a){var b=this;if(!this.base.isObservable)return;return this._setObservers.forEach(function(c,d){return b.base.event(c)[a](d)})},b}(E.Object),E.SetProxy=function(a){function i(a){var b=this;this.base=a,i.__super__.constructor.call(this),this.length=this.base.length,this.base.on("itemsWereAdded",function(){var a;return a=1<=arguments.length?T.call(arguments,0):[],b.set("length",b.base.length),b.fire.apply(b,["itemsWereAdded"].concat(T.call(a)))}),this.base.on("itemsWereRemoved",function(){var a;return a=1<=arguments.length?T.call(arguments,0):[],b.set("length",b.base.length),b.fire.apply(b,["itemsWereRemoved"].concat(T.call(a)))})}var b,c,d,e,g,h=this;W(i,a),i.name="SetProxy",f(i.prototype),i.prototype.filter=function(a){var b;return b=new E.Set,this.reduce(function(b,c){return a(c)&&b.add(c),b},b)},i.prototype.replace=function(){var a,b;return a=this.property("length"),a.isolate(),b=this.base.replace.apply(this,arguments),a.expose(),b},g=["add","remove","find","clear","has","merge","toArray","isEmpty","indexedBy","indexedByUnique","sortedBy"],c=function(a){return i.prototype[a]=function(){var b;return(b=this.base)[a].apply(b,arguments)}};for(d=0,e=g.length;d<e;d++)b=g[d],c(b);return E.Set._applySetAccessors(i),i.accessor("length",{get:function(){return this.registerAsMutableSource(),this.length},set:function(a,b){return this.length=b}}),i}.call(this,E.Object),E.SetSort=function(a){function b(a,c,d){var e;this.key=c,d==null&&(d="asc"),b.__super__.constructor.call(this,a),this.descending=d.toLowerCase()==="desc",this.base.isObservable&&(this._setObserver=new E.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],e=this._reIndex.bind(this),this._setObserver.observerForItemAndKey=function(){return e},this._setObserver.on("itemsWereAdded",e),this._setObserver.on("itemsWereRemoved",e),this.startObserving()),this._reIndex()}return W(b,a),b.name="SetSort",b.prototype.startObserving=function(){var a;return(a=this._setObserver)!=null?a.startObserving():void 0},b.prototype.stopObserving=function(){var a;return(a=this._setObserver)!=null?a.stopObserving():void 0},b.prototype.toArray=function(){return this.get("_storage")},b.prototype.forEach=function(a,b){var c,d,e,f,g,h;g=this.get("_storage"),h=[];for(d=e=0,f=g.length;e<f;d=++e)c=g[d],h.push(a.call(b,c,d,this));return h},b.prototype.compare=function(a,b){return a===b?0:a===void 0?1:b===void 0?-1:a===null?1:b===null?-1:a===!1?1:b===!1?-1:a===!0?1:b===!0?-1:a!==a?b!==b?0:1:b!==b?-1:a>b?1:a<b?-1:0},b.prototype._reIndex=function(){var a,b,c=this;return a=this.base.toArray().sort(function(a,b){var d,e,f;return e=j(a,c.key),typeof e=="function"&&(e=e.call(a)),e!=null&&(e=e.valueOf()),f=j(b,c.key),typeof f=="function"&&(f=f.call(b)),f!=null&&(f=f.valueOf()),d=c.descending?-1:1,c.compare.call(c,e,f)*d}),(b=this._setObserver)!=null&&b.startObservingItems.apply(b,a),this.set("_storage",a)},b}(E.SetProxy),E.SetIndex=function(a){function b(a,c){var d=this;this.base=a,this.key=c,b.__super__.constructor.call(this),this._storage=new E.SimpleHash,this.base.isEventEmitter&&(this._setObserver=new E.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],this._setObserver.observerForItemAndKey=this.observerForItemAndKey.bind(this),this._setObserver.on("itemsWereAdded",function(){var a,b,c,e,f;b=1<=arguments.length?T.call(arguments,0):[],f=[];for(c=0,e=b.length;c<e;c++)a=b[c],f.push(d._addItem(a));return f}),this._setObserver.on("itemsWereRemoved",function(){var a,b,c,e,f;b=1<=arguments.length?T.call(arguments,0):[],f=[];for(c=0,e=b.length;c<e;c++)a=b[c],f.push(d._removeItem(a));return f})),this.base.forEach(this._addItem.bind(this)),this.startObserving()}return W(b,a),b.name="SetIndex",b.prototype.propertyClass=E.Property,b.accessor(function(a){return this._resultSetForKey(a)}),b.prototype.startObserving=function(){var a;return(a=this._setObserver)!=null?a.startObserving():void 0},b.prototype.stopObserving=function(){var a;return(a=this._setObserver)!=null?a.stopObserving():void 0},b.prototype.observerForItemAndKey=function(a,b){var c=this;return function(b,d){return c._removeItemFromKey(a,d),c._addItemToKey(a,b)}},b.prototype._addItem=function(a){return this._addItemToKey(a,this._keyForItem(a))},b.prototype._addItemToKey=function(a,b){return this._resultSetForKey(b).add(a)},b.prototype._removeItem=function(a){return this._removeItemFromKey(a,this._keyForItem(a))},b.prototype._removeItemFromKey=function(a,b){return this._resultSetForKey(b).remove(a)},b.prototype._resultSetForKey=function(a){return this._storage.getOrSet(a,function(){return new E.Set})},b.prototype._keyForItem=function(a){return E.Keypath.forBaseAndKey(a,this.key).getValue()},b}(E.Object),E.UniqueSetIndex=function(a){function b(){this._uniqueIndex=new E.Hash,b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="UniqueSetIndex",b.accessor(function(a){return this._uniqueIndex.get(a)}),b.prototype._addItemToKey=function(a,b){this._resultSetForKey(b).add(a);if(!this._uniqueIndex.hasKey(b))return this._uniqueIndex.set(b,a)},b.prototype._removeItemFromKey=function(a,c){var d;return d=this._resultSetForKey(c),b.__super__._removeItemFromKey.apply(this,arguments),d.isEmpty()?this._uniqueIndex.unset(c):this._uniqueIndex.set(c,d.toArray()[0])},b}(E.SetIndex),E.BinarySetOperation=function(a){function b(a,c){this.left=a,this.right=c,this._setup=X(this._setup,this),b.__super__.constructor.call(this),this._setup(this.left,this.right),this._setup(this.right,this.left)}return W(b,a),b.name="BinarySetOperation",b.prototype._setup=function(a,b){var c=this;return a.on("itemsWereAdded",function(){var d;return d=1<=arguments.length?T.call(arguments,0):[],c._itemsWereAddedToSource.apply(c,[a,b].concat(T.call(d)))}),a.on("itemsWereRemoved",function(){var d;return d=1<=arguments.length?T.call(arguments,0):[],c._itemsWereRemovedFromSource.apply(c,[a,b].concat(T.call(d)))}),this._itemsWereAddedToSource.apply(this,[a,b].concat(T.call(a.toArray())))},b.prototype.merge=function(){var a,b,c,d,e;b=1<=arguments.length?T.call(arguments,0):[],a=new E.Set,b.unshift(this);for(d=0,e=b.length;d<e;d++)c=b[d],c.forEach(function(b){return a.add(b)});return a},b.prototype.filter=E.SetProxy.prototype.filter,b}(E.Set),E.SetUnion=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="SetUnion",b.prototype._itemsWereAddedToSource=function(){var a,b,c;return c=arguments[0],b=arguments[1],a=3<=arguments.length?T.call(arguments,2):[],this.add.apply(this,a)},b.prototype._itemsWereRemovedFromSource=function(){var a,b,c,d,e;return e=arguments[0],d=arguments[1],b=3<=arguments.length?T.call(arguments,2):[],c=function(){var c,e,f;f=[];for(c=0,e=b.length;c<e;c++)a=b[c],d.has(a)||f.push(a);return f}(),this.remove.apply(this,c)},b}(E.BinarySetOperation),E.SetIntersection=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="SetIntersection",b.prototype._itemsWereAddedToSource=function(){var a,b,c,d,e;return e=arguments[0],d=arguments[1],b=3<=arguments.length?T.call(arguments,2):[],c=function(){var c,e,f;f=[];for(c=0,e=b.length;c<e;c++)a=b[c],d.has(a)&&f.push(a);return f}(),this.add.apply(this,c)},b.prototype._itemsWereRemovedFromSource=function(){var a,b,c;return c=arguments[0],b=arguments[1],a=3<=arguments.length?T.call(arguments,2):[],this.remove.apply(this,a)},b}(E.BinarySetOperation),E.StateMachine={initialize:function(){E.initializeObject(this);if(!this._batman.states)return this._batman.states=new E.SimpleHash},state:function(a,b){E.StateMachine.initialize.call(this);if(!a)return this._batman.getFirst("state");K.assert(this.isEventEmitter,"StateMachine requires EventEmitter"),this[a]||(this[a]=function(b){return S.call(this,a)});if(typeof b=="function")return this.on(a,b)},transition:function(a,b,c){E.StateMachine.initialize.call(this),this.state(a),this.state(b);if(c)return this.on(""+a+"->"+b,c)}},E.Object.actsAsStateMachine=function(a){a==null&&(a=!0),E.StateMachine.initialize.call(this),E.StateMachine.initialize.call(this.prototype),this.classState=function(){return E.StateMachine.state.apply(this,arguments)},this.state=function(){return this.classState.apply(this.prototype,arguments)},a&&(this.prototype.state=this.classState),this.classTransition=function(){return E.StateMachine.transition.apply(this,arguments)},this.transition=function(){return this.classTransition.apply(this.prototype,arguments)};if(a)return this.prototype.transition=this.classTransition},S=function(a){var b,c,d;return E.StateMachine.initialize.call(this),this._batman.isTransitioning?(((c=this._batman).nextState||(c.nextState=[])).push(a),!1):(this._batman.isTransitioning=!0,b=this.state(),this._batman.state=a,a&&b&&this.fire(""+b+"->"+a,a,b),a&&this.fire(a,a,b),this._batman.isTransitioning=!1,((d=this._batman.nextState)!=null?d.length:void 0)&&this[this._batman.nextState.shift()](),a)},E.Request=function(a){function d(a){var b,c,e;c={};for(e in a){b=a[e];if(e!=="success"&&e!=="error"&&e!=="loading"&&e!=="loaded")continue;c[e]=b,delete a[e]}d.__super__.constructor.call(this,a);for(e in c)b=c[e],this.on(e,b)}var b;return W(d,a),d.name="Request",d.objectToFormData=function(a){var b,c,d,e,f,g,h,i;d=function(a,b,c){var e,f,g;return c==null&&(c=!1),f=function(){switch(E.typeOf(b)){case"Object":return f=function(){var f;f=[];for(e in b)g=b[e],f.push(d(c?e:""+a+"["+e+"]",g));return f}(),f.reduce(function(a,b){return a.concat(b)},[]);case"Array":return b.reduce(function(b,c){return b.concat(d(""+a+"[]",c))},[]);default:return[[a,b]]}}()},b=new E.container.FormData,h=d("",a,!0);for(f=0,g=h.length;f<g;f++)i=h[f],c=i[0],e=i[1],b.append(c,e);return b},d.prototype.url="",d.prototype.data="",d.prototype.method="GET",d.dataHasFileUploads=b=function(a){var c,d,e,f,g;if(a instanceof File)return!0;d=A(a);switch(d){case"Object":for(c in a){e=a[c];if(b(e))return!0}break;case"Array":for(f=0,g=a.length;f<g;f++){e=a[f];if(b(e))return!0}}return!1},d.prototype.hasFileUploads=function(){return b(this.data)},d.prototype.response=null,d.prototype.status=null,d.prototype.headers={},d.accessor("method",o({},E.Property.defaultAccessor,{set:function(a,b){return this[a]=b!=null?typeof b.toUpperCase=="function"?b.toUpperCase():void 0:void 0}})),d.prototype.contentType="application/x-www-form-urlencoded",d.observeAll("url",function(a){var b=this;return this._autosendTimeout=v(function(){return b.send()})}),d.prototype.send=function(){return K.error("Please source a dependency file for a request implementation")},d.prototype.cancel=function(){if(this._autosendTimeout)return c(this._autosendTimeout)},d}(E.Object),E.Route=function(a){function b(a,c){var d,e,f,g,h,i,j,k,l,m;j=this.constructor.regexps,a.indexOf("/")!==0&&(a="/"+a),g=a.replace(j.escapeRegExp,"\\$&"),i=RegExp("^"+g.replace(j.namedParam,"([^/]+)").replace(j.splatParam,"(.*?)")+j.queryParam+"$"),f=function(){var a;a=[];while(e=j.namedOrSplat.exec(g))a.push(e[1]);return a}(),h={templatePath:a,pattern:g,regexp:i,namedArguments:f,baseParams:c},m=this.optionKeys;for(k=0,l=m.length;k<l;k++)d=m[k],h[d]=c[d],delete c[d];b.__super__.constructor.call(this,h)}return W(b,a),b.name="Route",b.regexps={namedParam:/:([\w\d]+)/g,splatParam:/\*([\w\d]+)/g,queryParam:"(?:\\?.+)?",namedOrSplat:/[:|\*]([\w\d]+)/g,namePrefix:"[:|*]",escapeRegExp:/[-[\]{}()+?.,\\^$|#\s]/g},b.prototype.optionKeys=["member","collection"],b.prototype.testKeys=["controller","action"],b.prototype.isRoute=!0,b.prototype.paramsFromPath=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,p,q,r,s;q=a.split("?"),a=q[0],j=q[1],g=this.get("namedArguments"),i=o({path:a},this.get("baseParams")),e=this.get("regexp").exec(a).slice(1);for(b=l=0,n=e.length;l<n;b=++l)d=e[b],f=g[b],i[f]=d;if(j){r=j.split("&");for(m=0,p=r.length;m<p;m++)h=r[m],s=h.split("="),c=s[0],k=s[1],i[c]=k}return i},b.prototype.pathFromParams=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,p;e=o({},a),f=this.get("templatePath"),n=this.get("namedArguments");for(j=0,l=n.length;j<l;j++)c=n[j],h=RegExp(""+this.constructor.regexps.namePrefix+c),d=f.replace(h,e[c]!=null?e[c]:""),d!==f&&(delete e[c],f=d);p=this.testKeys;for(k=0,m=p.length;k<m;k++)b=p[k],delete e[b];return g=function(){var a;a=[];for(b in e)i=e[b],a.push(""+b+"="+i);return a}(),g.length>0&&(f+="?"+g.join("&")),f},b.prototype.test=function(a){var b,c,d,e,f,g;if(typeof a=="string")c=a;else if(a.path!=null)c=a.path;else{c=this.pathFromParams(a),g=this.testKeys;for(e=0,f=g.length;e<f;e++){b=g[e];if((d=this.get(b))!=null&&a[b]!==d)return!1}}return this.get("regexp").test(c)},b.prototype.dispatch=function(a){var b,c;return this.test(a)?(typeof a=="string"?(b=this.paramsFromPath(a),c=a):(b=a,c=this.pathFromParams(a)),this.get("callback")(b),c):!1},b.prototype.callback=function(){throw new E.DevelopmentError("Override callback in a Route subclass")},b}(E.Object),E.CallbackActionRoute=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="CallbackActionRoute",b.prototype.optionKeys=["member","collection","callback","app"],b.prototype.controller=!1,b.prototype.action=!1,b}(E.Route),E.ControllerActionRoute=function(a){function b(a,c){this.callback=X(this.callback,this);var d,e,f;c.signature&&(f=c.signature.split("#"),e=f[0],d=f[1],d||(d="index"),c.controller=e,c.action=d,delete c.signature),b.__super__.constructor.call(this,a,c)}return W(b,a),b.name="ControllerActionRoute",b.prototype.optionKeys=["member","collection","app","controller","action"],b.prototype.callback=function(a){var b;return b=this.get("app.dispatcher.controllers."+this.get("controller")),b.dispatch(this.get("action"),a)},b}(E.Route),E.Dispatcher=function(a){function c(a,b){c.__super__.constructor.call(this,{app:a,routeMap:b})}var b;return W(c,a),c.name="Dispatcher",c.canInferRoute=function(a){return a instanceof E.Model||a instanceof E.AssociationProxy||a.prototype instanceof E.Model},c.paramsFromArgument=function(a){var b;return b=function(a){return L.camelize(L.pluralize(i(a)),!0)},this.canInferRoute(a)?a instanceof E.Model||a instanceof E.AssociationProxy?(a.isProxy&&(a=a.get("target")),a!=null?{controller:b(a.constructor),action:"show",id:a.get("id")}:{}):a.prototype instanceof E.Model?{controller:b(a),action:"index"}:a:a},b=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="ControllerDirectory",b.accessor("__app",E.Property.defaultAccessor),b.accessor(function(a){return this.get("__app."+L.capitalize(a)+"Controller.sharedController")}),b}(E.Object),c.accessor("controllers",function(){return new b({__app:this.get("app")})}),c.prototype.routeForParams=function(a){return a=this.constructor.paramsFromArgument(a),this.get("routeMap").routeForParams(a)},c.prototype.pathFromParams=function(a){var b;return typeof a=="string"?a:(a=this.constructor.paramsFromArgument(a),(b=this.routeForParams(a))!=null?b.pathFromParams(a):void 0)},c.prototype.dispatch=function(a){var b,c,d;b=this.constructor.paramsFromArgument(a),d=this.routeForParams(b);if(d)c=d.dispatch(b);else{if(A(a)==="Object"&&!this.constructor.canInferRoute(a))return this.get("app.currentParams").replace(a);this.get("app.currentParams").clear();if(c!=="/404"&&a!=="/404")return E.redirect("/404")}return this.set("app.currentURL",c),this.set("app.currentRoute",d),c},c}.call(this,E.Object),E.RouteMap=function(){function a(){this.childrenByOrder=[],this.childrenByName={}}return a.name="RouteMap",a.prototype.memberRoute=null,a.prototype.collectionRoute=null,a.prototype.routeForParams=function(a){var b,c,d,e;e=this.childrenByOrder;for(c=0,d=e.length;c<d;c++){b=e[c];if(b.test(a))return b}},a.prototype.addRoute=function(a,b){var c,d,e=this;return this.childrenByOrder.push(b),a.length>0&&(d=a.split(".")).length>0?(c=d.shift(),this.childrenByName[c]||(this.childrenByName[c]=new E.RouteMap),this.childrenByName[c].addRoute(d.join("."),b)):b.get("member")?(K["do"](function(){if(e.memberRoute)return E.developer.error("Member route with name "+a+" already exists!")}),this.memberRoute=b):(K["do"](function(){if(e.collectionRoute)return E.developer.error("Collection route with name "+a+" already exists!")}),this.collectionRoute=b),!0},a}(),E.NamedRouteQuery=function(a){function c(a,b){b==null&&(b=[]),c.__super__.constructor.call(this,{routeMap:a,args:b})}var b=this;return W(c,a),c.name="NamedRouteQuery",c.prototype.isNamedRouteQuery=!0,K["do"](function(){var a;return a=function(a){function b(){K.suppress(),b.__super__.constructor.apply(this,arguments),K.unsuppress()}return W(b,a),b.name="NonWarningProperty",b}(E.Keypath),c.prototype.propertyClass=a}),c.accessor("route",function(){var a,b,c,d,e,f,g;f=this.get("routeMap"),b=f.memberRoute,a=f.collectionRoute,g=[b,a];for(d=0,e=g.length;d<e;d++){c=g[d];if(c!=null&&c.namedArguments.length===this.get("args").length)return c}return a||b}),c.accessor("path",function(){var a,b,c,d,e,f,g;e={},d=this.get("route.namedArguments");for(c=f=0,g=d.length;f<g;c=++f)a=d[c],(b=this.get("args")[c])!=null&&(e[a]=this._toParam(b));return this.get("route").pathFromParams(e)}),c.accessor("routeMap","args","cardinality",E.Property.defaultAccessor),c.accessor({get:function(a){if(a==null)return;return typeof a=="string"?this.nextQueryForName(a):this.nextQueryWithArgument(a)},set:function(){},cacheable:!1}),c.prototype.nextQueryForName=function(a){var b;return(b=this.get("routeMap").childrenByName[a])?new E.NamedRouteQuery(b,this.args):E.developer.error("Couldn't find a route for the name "+a+"!")},c.prototype.nextQueryWithArgument=function(a){var b;return b=this.args.slice(0),b.push(a),this.clone(b)},c.prototype._toParam=function(a){return a instanceof E.AssociationProxy&&(a=a.get("target")),a.toParam!=="undefined"?a.toParam():a},c.prototype._paramName=function(a){var b;return b=L.singularize(i(a))+"Id",b.charAt(0).toLowerCase()+b.slice(1)},c.prototype.clone=function(a){return a==null&&(a=this.args),new E.NamedRouteQuery(this.routeMap,a)},c}.call(this,E.Object),E.RouteMapBuilder=function(){function a(a,b,c,d){this.app=a,this.routeMap=b,this.parent=c,this.baseOptions=d!=null?d:{},this.parent?(this.rootPath=this.parent._nestingPath(),this.rootName=this.parent._nestingName()):(this.rootPath="",this.rootName="")}return a.name="RouteMapBuilder",a.BUILDER_FUNCTIONS=["resources","member","collection","route","root"],a.ROUTES={index:{cardinality:"collection",path:function(a){return a},name:function(a){return a}},"new":{cardinality:"collection",path:function(a){return""+a+"/new"},name:function(a){return""+a+".new"}},show:{cardinality:"member",path:function(a){return""+a+"/:id"},name:function(a){return a}},edit:{cardinality:"member",path:function(a){return""+a+"/:id/edit"},name:function(a){return""+a+".edit"}},collection:{cardinality:"collection",path:function(a,b){return""+a+"/"+b},name:function(a,b){return""+a+"."+b}},member:{cardinality:"member",path:function(a,b){return""+a+"/:id/"+b},name:function(a,b){return""+a+"."+b}}},a.prototype.resources=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,p,q,r,s,t,u,v,w,x,y,z,A;d=1<=arguments.length?T.call(arguments,0):[],n=function(){var a,b,e;e=[];for(a=0,b=d.length;a<b;a++)c=d[a],typeof c=="string"&&e.push(c);return e}(),typeof d[d.length-1]=="function"&&(f=d.pop()),typeof d[d.length-1]=="object"?k=d.pop():k={},b={index:!0,"new":!0,show:!0,edit:!0};if(k.except){z=k.except;for(t=0,w=z.length;t<w;t++)j=z[t],b[j]=!1;delete k.except}else if(k.only){for(j in b)s=b[j],b[j]=!1;A=k.only;for(u=0,x=A.length;u<x;u++)j=A[u],b[j]=!0;delete k.only}for(v=0,y=n.length;v<y;v++){m=n[v],p=L.pluralize(m),h=L.camelize(p,!0),g=this._childBuilder({controller:h}),f!=null&&f.call(g);for(a in b){i=b[a];if(!i)continue;q=this.constructor.ROUTES[a],e=q.name(p),l=q.path(p),r=o({controller:h,action:a,path:l,as:e},k),g[q.cardinality](a,r)}}return!0},a.prototype.member=function(){return this._addRoutesWithCardinality.apply(this,["member"].concat(T.call(arguments)))},a.prototype.collection=function(){return this._addRoutesWithCardinality.apply(this,["collection"].concat(T.call(arguments)))},a.prototype.root=function(a,b){return this.route("/",a,b)},a.prototype.route=function(a,b,c,d){return d||(typeof c=="function"?(d=c,c=void 0):typeof b=="function"&&(d=b,b=void 0)),c?b&&(c.signature=b):(typeof b=="string"?c={signature:b}:c=b,c||(c={})),d&&(c.callback=d),c.as||(c.as=this._nameFromPath(a)),c.path=a,this._addRoute(c)},a.prototype._addRoutesWithCardinality=function(){var a,b,c,d,e,f,g,h,i,j;a=arguments[0],c=3<=arguments.length?T.call(arguments,1,h=arguments.length-1):(h=1,[]),d=arguments[h++],typeof d=="string"&&(c.push(d),d={}),d=o({},this.baseOptions,d),d[a]=!0,f=this.constructor.ROUTES[a],e=d.controller;for(i=0,j=c.length;i<j;i++)b=c[i],g=o({action:b},d),g.path==null&&(g.path=f.path(e,b)),g.as==null&&(g.as=f.name(e,b)),this._addRoute(g);return!0},a.prototype._addRoute=function(a){var b,c,d,e;return a==null&&(a={}),d=this.rootPath+a.path,c=this.rootName+a.as,delete a.as,delete a.path,b=a.callback?E.CallbackActionRoute:E.ControllerActionRoute,a.app=this.app,e=new b(d,a),this.routeMap.addRoute(c,e)},a.prototype._nameFromPath=function(a){var b,c;return c=a.replace(E.Route.regexps.namedOrSplat,"").replace(/\/+/g,"_").replace(/(^_)|(_$)/g,""),b=L.camelize(c),b.charAt(0).toLowerCase()+b.slice(1)},a.prototype._nestingPath=function(){var a;return this.parent?(a=":"+L.singularize(this.baseOptions.controller)+"Id",""+this.parent._nestingPath()+"/"+this.baseOptions.controller+"/"+a+"/"):""},a.prototype._nestingName=function(){return this.parent?this.baseOptions.controller+".":""},a.prototype._childBuilder=function(a){return a==null&&(a={}),new E.RouteMapBuilder(this.app,this.routeMap,this,a)},a}(),E.Navigator=function(){function a(a){this.app=a,this.handleCurrentLocation=X(this.handleCurrentLocation,this)}return a.name="Navigator",a.defaultClass=function(){return E.config.usePushState&&E.PushStateNavigator.isSupported()?E.PushStateNavigator:E.HashbangNavigator},a.forApp=function(a){return new(this.defaultClass())(a)},a.prototype.start=function(){var a=this;if(typeof window=="undefined")return;if(this.started)return;return this.started=!0,this.startWatching(),E.currentApp.prevent("ready"),v(function(){if(a.started&&E.currentApp)return a.handleCurrentLocation(),E.currentApp.allowAndFire("ready")})},a.prototype.stop=function(){return this.stopWatching(),this.started=!1},a.prototype.handleLocation=function(a){var b;b=this.pathFromLocation(a);if(b===this.cachedPath)return;return this.dispatch(b)},a.prototype.handleCurrentLocation=function(){return this.handleLocation(window.location)},a.prototype.dispatch=function(a){return this.cachedPath=this.app.get("dispatcher").dispatch(a)},a.prototype.push=function(a){var b;return b=this.dispatch(a),this.pushState(null,"",b),b},a.prototype.replace=function(a){var b;return b=this.dispatch(a),this.replaceState(null,"",b),b},a.prototype.redirect=a.prototype.push,a.prototype.normalizePath=function(){var a,b,c;return c=1<=arguments.length?T.call(arguments,0):[],c=function(){var d,e,f;f=[];for(a=d=0,e=c.length;d<e;a=++d)b=c[a],f.push((""+b).replace(/^(?!\/)/,"/").replace(/\/+$/,""));return f}(),c.join("")||"/"},a.normalizePath=a.prototype.normalizePath,a}(),E.PushStateNavigator=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return W(c,b),c.name="PushStateNavigator",c.isSupported=function(){var a;return(typeof window!=="undefined"&&window!==null?(a=window.history)!=null?a.pushState:void 0:void 0)!=null},c.prototype.startWatching=function(){return a(window,"popstate",this.handleCurrentLocation)},c.prototype.stopWatching=function(){return t(window,"popstate",this.handleCurrentLocation)},c.prototype.pushState=function(a,b,c){return window.history.pushState(a,b,this.linkTo(c))},c.prototype.replaceState=function(a,b,c){return window.history.replaceState(a,b,this.linkTo(c))},c.prototype.linkTo=function(a){return this.normalizePath(E.config.pathPrefix,a)},c.prototype.pathFromLocation=function(a){var b,c;return b=""+(a.pathname||"")+(a.search||""),c=new RegExp("^"+this.normalizePath(E.config.pathPrefix)),this.normalizePath(b.replace(c,""))},c.prototype.handleLocation=function(a){var b,d;return d=this.pathFromLocation(a),d==="/"&&(b=E.HashbangNavigator.prototype.pathFromLocation(a))!=="/"?this.replace(b):c.__super__.handleLocation.apply(this,arguments)},c}(E.Navigator),E.HashbangNavigator=function(b){function c(){return c.__super__.constructor.apply(this,arguments)}return W(c,b),c.name="HashbangNavigator",c.prototype.HASH_PREFIX="#!",typeof window!="undefined"&&window!==null&&"onhashchange"in window?(c.prototype.startWatching=function(){return a(window,"hashchange",this.handleCurrentLocation)},c.prototype.stopWatching=function(){return t(window,"hashchange",this.handleCurrentLocation)}):(c.prototype.startWatching=function(){return this.interval=setInterval(this.handleCurrentLocation,100)},c.prototype.stopWatching=function(){return this.interval=clearInterval(this.interval)}),c.prototype.pushState=function(a,b,c){return window.location.hash=this.linkTo(c)},c.prototype.replaceState=function(a,b,c){var d;return d=window.location,d.replace(""+d.pathname+d.search+this.linkTo(c))},c.prototype.linkTo=function(a){return this.HASH_PREFIX+a},c.prototype.pathFromLocation=function(a){var b;return b=a.hash,(b!=null?b.substr(0,2):void 0)===this.HASH_PREFIX?this.normalizePath(b.substr(2)):"/"},c.prototype.handleLocation=function(a){var b;return E.config.usePushState?(b=E.PushStateNavigator.prototype.pathFromLocation(a),b==="/"?c.__super__.handleLocation.apply(this,arguments):a.replace(this.normalizePath(""+E.config.pathPrefix+this.linkTo(b)))):c.__super__.handleLocation.apply(this,arguments)},c}(E.Navigator),E.redirect=s=function(a){var b;return(b=E.navigator)!=null?b.redirect(a):void 0},E.ParamsReplacer=function(a){function b(a,b){this.navigator=a,this.params=b}return W(b,a),b.name="ParamsReplacer",b.prototype.redirect=function(){return this.navigator.replace(this.
toObject())},b.prototype.replace=function(a){return this.params.replace(a),this.redirect()},b.prototype.update=function(a){return this.params.update(a),this.redirect()},b.prototype.clear=function(){return this.params.clear(),this.redirect()},b.prototype.toObject=function(){return this.params.toObject()},b.accessor({get:function(a){return this.params.get(a)},set:function(a,b){var c,d;return c=this.params.get(a),d=this.params.set(a,b),c!==b&&this.redirect(),d},unset:function(a){var b,c;return b=this.params.hasKey(a),c=this.params.unset(a),b&&this.redirect(),c}}),b}(E.Object),E.ParamsPusher=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="ParamsPusher",b.prototype.redirect=function(){return this.navigator.push(this.toObject())},b}(E.ParamsReplacer),E.App=function(a){function h(){return h.__super__.constructor.apply(this,arguments)}var b,c,d,e,f,g=this;W(h,a),h.name="App",h.classAccessor("currentParams",{get:function(){return new E.Hash},"final":!0}),h.classAccessor("paramsManager",{get:function(){var a,b;if(!(a=this.get("navigator")))return;return b=this.get("currentParams"),b.replacer=new E.ParamsReplacer(a,b)},"final":!0}),h.classAccessor("paramsPusher",{get:function(){var a,b;if(!(a=this.get("navigator")))return;return b=this.get("currentParams"),b.pusher=new E.ParamsPusher(a,b)},"final":!0}),h.classAccessor("routes",function(){return new E.NamedRouteQuery(this.get("routeMap"))}),h.classAccessor("routeMap",function(){return new E.RouteMap}),h.classAccessor("routeMapBuilder",function(){return new E.RouteMapBuilder(this,this.get("routeMap"))}),h.classAccessor("dispatcher",function(){return new E.Dispatcher(this,this.get("routeMap"))}),h.classAccessor("controllers",function(){return this.get("dispatcher.controllers")}),h.classAccessor("_renderContext",function(){return E.RenderContext.base.descend(this)}),h.requirePath="",K["do"](function(){return h.require=function(){var a,b,c,d,e,f,g=this;d=arguments[0],c=2<=arguments.length?T.call(arguments,1):[],a=this.requirePath+d;for(e=0,f=c.length;e<f;e++)b=c[e],this.prevent("run"),d=a+"/"+b+".coffee",new E.Request({url:d,type:"html",success:function(a){CoffeeScript.eval(a),g.allow("run"),g.isPrevented("run")||g.fire("loaded");if(g.wantsToRun)return g.run()}});return this},h.controller=function(){var a;return a=1<=arguments.length?T.call(arguments,0):[],a=a.map(function(a){return a+"_controller"}),this.require.apply(this,["controllers"].concat(T.call(a)))},h.model=function(){return this.require.apply(this,["models"].concat(T.call(arguments)))},h.view=function(){return this.require.apply(this,["views"].concat(T.call(arguments)))}}),h.layout=void 0,f=E.RouteMapBuilder.BUILDER_FUNCTIONS,c=function(a){return h[a]=function(){var b;return(b=this.get("routeMapBuilder"))[a].apply(b,arguments)}};for(d=0,e=f.length;d<e;d++)b=f[d],c(b);return h.event("ready").oneShot=!0,h.event("run").oneShot=!0,h.run=function(){var a=this;if(E.currentApp){if(E.currentApp===this)return;E.currentApp.stop()}return this.hasRun?!1:this.isPrevented("run")?(this.wantsToRun=!0,!1):(delete this.wantsToRun,E.currentApp=this,E.App.set("current",this),this.get("dispatcher")==null&&(this.set("dispatcher",new E.Dispatcher(this,this.get("routeMap"))),this.set("controllers",this.get("dispatcher.controllers"))),this.get("navigator")==null&&(this.set("navigator",E.Navigator.forApp(this)),this.on("run",function(){E.navigator=a.get("navigator");if(Object.keys(a.get("dispatcher").routeMap).length>0)return E.navigator.start()})),this.observe("layout",function(b){return b!=null?b.on("ready",function(){return a.fire("ready")}):void 0}),typeof this.layout=="undefined"?this.set("layout",new E.View({context:this,node:document})):typeof this.layout=="string"&&this.set("layout",new(this[L.camelize(this.layout)+"View"])),this.hasRun=!0,this.fire("run"),this)},h.event("ready").oneShot=!0,h.event("stop").oneShot=!0,h.stop=function(){var a;return(a=this.navigator)!=null&&a.stop(),E.navigator=null,this.hasRun=!1,this.fire("stop"),this},h}.call(this,E.Object),E.Controller=function(a){function b(){return this.redirect=X(this.redirect,this),b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="Controller",b.singleton("sharedController"),b.accessor("controllerName",function(){return this._controllerName||(this._controllerName=L.underscore(i(this.constructor).replace("Controller","")))}),b.accessor("_renderContext",function(){return E.RenderContext.root().descend(this)}),b.beforeFilter=function(a,b){var c,d;return b?(a.only&&A(a.only)!=="Array"&&(a.only=[a.only]),a.except&&A(a.except)!=="Array"&&(a.except=[a.except])):(b=a,a={}),E.initializeObject(this),a.block=b,c=(d=this._batman).beforeFilters||(d.beforeFilters=new E.Hash),c.set(b,a)},b.afterFilter=function(a,b){var c,d;return b?(a.only&&A(a.only)!=="Array"&&(a.only=[a.only]),a.except&&A(a.except)!=="Array"&&(a.except=[a.except])):(b=a,a={}),E.initializeObject(this),a.block=b,c=(d=this._batman).afterFilters||(d.afterFilters=new E.Hash),c.set(b,a)},b.prototype.runFilters=function(a,b){var c,d,e=this;c=a.action;if(b=(d=this.constructor._batman)!=null?d.get(b):void 0)return b.forEach(function(b,d){var f;if(d.only&&V.call(d.only,c)<0)return;if(d.except&&V.call(d.except,c)>=0)return;return f=d.block,typeof f=="function"?f.call(e,a):typeof e[f]=="function"?e[f](a):void 0})},b.prototype.dispatch=function(a,b){var c,d,e,f,g;b==null&&(b={}),b.controller||(b.controller=this.get("controllerName")),b.action||(b.action=a),b.target||(b.target=this),c=(e=E.navigator)!=null?e.redirect:void 0,(f=E.navigator)!=null&&(f.redirect=this.redirect),this._inAction=!0,this._actedDuringAction=!1,this.set("action",a),this.set("params",b),this.runFilters(b,"beforeFilters"),K.assert(this[a],"Error! Controller action "+this.get("controllerName")+"."+a+" couldn't be found!"),this[a](b),this._actedDuringAction||this.render(),this.runFilters(b,"afterFilters"),delete this._actedDuringAction,delete this._inAction,(g=E.navigator)!=null&&(g.redirect=c),d=this._afterFilterRedirect,delete this._afterFilterRedirect;if(d)return s(d)},b.prototype.redirect=function(a){return this._actedDuringAction&&this._inAction&&K.warn("Warning! Trying to redirect but an action has already be taken during "+this.get("controllerName")+"."+this.get("action")+"}"),this._inAction?(this._actedDuringAction=!0,this._afterFilterRedirect=a):(A(a)==="Object"&&(a.controller||(a.controller=this)),s(a))},b.prototype.render=function(a){var b,c,d,e=this;a==null&&(a={}),this._actedDuringAction&&this._inAction&&K.warn("Warning! Trying to render but an action has already be taken during "+this.get("controllerName")+"."+this.get("action")),this._actedDuringAction=!0;if(a===!1)return;a.view||(a.viewClass||(a.viewClass=((c=E.currentApp)!=null?c[L.camelize(""+this.get("controllerName")+"_"+this.get("action")+"_view")]:void 0)||E.View),a.context||(a.context=this.get("_renderContext")),a.source||(a.source=L.underscore(this.get("controllerName")+"/"+this.get("action"))),a.view=new a.viewClass(a));if(b=a.view)(d=E.currentApp)!=null&&d.prevent("ready"),b.on("ready",function(){var c,d;return c=a.into||"main",E.DOM.fillYieldContainer(c,b.get("node"),!0,b.hasContainer),(d=E.currentApp)!=null&&d.allowAndFire("ready"),typeof b.ready=="function"?b.ready(e.params):void 0});return b},b}(E.Object),E.Model=function(a){function j(a){a==null&&(a={}),this.destroy=X(this.destroy,this),this.save=X(this.save,this),this.load=X(this.load,this),K.assert(this instanceof E.Object,"constructors must be called with new"),this.dirtyKeys=new E.Hash,this.errors=new E.ErrorsSet,A(a)==="Object"?j.__super__.constructor.call(this,a):(j.__super__.constructor.call(this),this.set("id",a)),this.state()||this.empty()}var b,c,d,e,f,g,h;W(j,a),j.name="Model",j.primaryKey="id",j.storageKey=null,j.persist=function(){var a,b,c,d,e;return b=1<=arguments.length?T.call(arguments,0):[],E.initializeObject(this.prototype),d=(e=this.prototype._batman).storage||(e.storage=[]),c=function(){var c,e,f;f=[];for(c=0,e=b.length;c<e;c++)a=b[c],a=a.isStorageAdapter?a:new a(this),d.push(a),f.push(a);return f}.call(this),c.length>1?c:c[0]},j.encode=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;e=2<=arguments.length?T.call(arguments,0,i=arguments.length-1):(i=0,[]),b=arguments[i++],E.initializeObject(this.prototype),(g=this.prototype._batman).encoders||(g.encoders=new E.SimpleHash),(h=this.prototype._batman).decoders||(h.decoders=new E.SimpleHash),a={};switch(A(b)){case"String":e.push(b);break;case"Function":a.encode=b;break;default:a.encode=b.encode,a.decode=b.decode}a=o({},this.defaultEncoder,a),n=["encode","decode"];for(j=0,l=n.length;j<l;j++){f=n[j];for(k=0,m=e.length;k<m;k++)d=e[k],c=this.prototype._batman[""+f+"rs"],a[f]?c.set(d,a[f]):c.unset(d)}},j.defaultEncoder={encode:function(a){return a},decode:function(a){return a}},j.observeAndFire("primaryKey",function(a,b){return this.encode(b,{encode:!1,decode:!1}),this.encode(a,{encode:!1,decode:this.defaultEncoder.decode})}),j.validate=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;a=2<=arguments.length?T.call(arguments,0,i=arguments.length-1):(i=0,[]),e=arguments[i++],E.initializeObject(this.prototype),g=(h=this.prototype._batman).validators||(h.validators=[]);if(typeof e=="function")return g.push({keys:a,callback:e});d=e,n=[];for(j=0,l=G.length;j<l;j++){f=G[j];if(c=f.matches(d)){for(k=0,m=c.length;k<m;k++)b=c[k],delete d[b];n.push(g.push({keys:a,validator:new f(c)}))}else n.push(void 0)}return n},j.urlNestsUnder=function(a){var b,c;return c=E.helpers.pluralize(a),b=E.helpers.pluralize(E._functionName(this).toLowerCase()),this.url=function(d){var e;return e=d.data[a+"_id"],delete d.data[a+"_id"],""+c+"/"+e+"/"+b},this.prototype.url=function(){var d,e;e=""+c+"/"+this.get(a+"_id")+"/"+b;if(d=this.get("id"))e+="/"+d;return e}},j.classAccessor("all",{get:function(){var a;return this.prototype.hasStorage()&&(a=this.classState())!=="loaded"&&a!=="loading"&&this.load(),this.get("loaded")},set:function(a,b){return this.set("loaded",b)}}),j.classAccessor("loaded",{get:function(){return this._loaded||(this._loaded=new E.Set)},set:function(a,b){return this._loaded=b}}),j.classAccessor("first",function(){return this.get("all").toArray()[0]}),j.classAccessor("last",function(){var a;return a=this.get("all").toArray(),a[a.length-1]}),j.clear=function(){var a,b;return E.initializeObject(this),a=this.get("loaded").clear(),(b=this._batman.get("associations"))!=null&&b.reset(),a},j.find=function(a,b){var c;return K.assert(b,"Must call find with a callback!"),c=new this,c.set("id",a),c.load(b),c},j.load=function(a,b){var c,d=this;if((c=typeof a)==="function"||c==="undefined")b=a,a={};return K.assert(this.prototype._batman.getAll("storage").length,"Can't load model "+i(this)+" without any storage adapters!"),this.loading(),this.prototype._doStorageOperation("readAll",a,function(a,c){var e,f;return a!=null?typeof b=="function"?b(a,[]):void 0:(e=function(){var a,b,d;d=[];for(a=0,b=c.length;a<b;a++)f=c[a],d.push(this._mapIdentity(f));return d}.call(d),d.loaded(),typeof b=="function"?b(a,e):void 0)})},j.create=function(a,b){var c,d;return b||(d=[{},a],a=d[0],b=d[1]),c=new this(a),c.save(b),c},j.findOrCreate=function(a,b){var c,d;return d=new this(a),d.isNew()?d.save(b):(c=this._mapIdentity(d),b(void 0,c)),d},j._mapIdentity=function(a){var b,c,d;return typeof (c=a.get("id"))=="undefined"||c===""?a:(b=(d=this.get("loaded.indexedBy.id").get(c))!=null?d.toArray()[0]:void 0,b?(b.updateAttributes(a._batman.attributes||{}),b):(this.get("loaded").add(a),a))},j.accessor("id",{get:function(){var a;return a=this.constructor.primaryKey,a==="id"?this.id:this.get(a)},set:function(a,b){var c;return typeof b=="string"&&b.match(/[^0-9]/)===null&&(b=parseInt(b,10)),c=this.constructor.primaryKey,c==="id"?this.id=b:this.set(c,b)}}),j.accessor("dirtyKeys","errors",E.Property.defaultAccessor),j.accessor("batmanState",{get:function(){return this.state()},set:function(a,b){return this.state(b)}}),j.accessor(j.defaultAccessor={get:function(a){var b,c;return b=((c=this._batman).attributes||(c.attributes={}))[a],typeof b!="undefined"?b:this[a]},set:function(a,b){var c;return((c=this._batman).attributes||(c.attributes={}))[a]=b},unset:function(a){var b,c;return b=((c=this._batman).attributes||(c.attributes={}))[a],delete this._batman.attributes[a],b}}),j.prototype.isNew=function(){return typeof this.get("id")=="undefined"},j.prototype.set=function(a,b){var c,d;c=this.get(a);if(c===b)return;return d=j.__super__.set.apply(this,arguments),this._markDirtyKeyAndStorePreviousValue(a,c),d},j.prototype._markDirtyKeyAndStorePreviousValue=function(a,b){var c;this.dirtyKeys.set(a,b);if((c=this.state())!=="dirty"&&c!=="loading"&&c!=="creating")return this.dirty()},j.prototype.updateAttributes=function(a){return this.mixin(a),this},j.prototype.toString=function(){return""+i(this.constructor)+": "+this.get("id")},j.prototype.toJSON=function(){var a,b,c=this;return b={},a=this._batman.get("encoders"),!!a&&!a.isEmpty()&&a.forEach(function(a,d){var e,f;f=c.get(a);if(typeof f!="undefined"){e=d(f,a,b,c);if(typeof e!="undefined")return b[a]=e}}),b},j.prototype.fromJSON=function(a){var b,c,d,e,f=this;d={},b=this._batman.get("decoders");if(!b||b.isEmpty())for(c in a)e=a[c],d[c]=e;else b.forEach(function(b,c){if(typeof a[b]!="undefined")return d[b]=c(a[b],b,a,d,f)});return this.constructor.primaryKey!=="id"&&(d.id=a[this.constructor.primaryKey]),K["do"](function(){if(!b||b.length<=1)return K.warn("Warning: Model "+i(f.constructor)+" has suspiciously few decoders!")}),this.mixin(d)},j.prototype.toParam=function(){return this.get("id")},j.actsAsStateMachine(!0),g=["empty","dirty","loading","loaded","saving","saved","creating","created","validating","validated","destroying","destroyed"];for(c=0,e=g.length;c<e;c++)b=g[c],j.state(b);h=["loading","loaded"];for(d=0,f=h.length;d<f;d++)b=h[d],j.classState(b);return j.prototype._doStorageOperation=function(a,b,c){var d,e,f,g;K.assert(this.hasStorage(),"Can't "+a+" model "+i(this.constructor)+" without any storage adapters!"),e=this._batman.get("storage");for(f=0,g=e.length;f<g;f++)d=e[f],d.perform(a,this,{data:b},c);return!0},j.prototype.hasStorage=function(){return(this._batman.get("storage")||[]).length>0},j.prototype.load=function(a,b){var c,d,e=this;b||(c=[{},a],a=c[0],b=c[1]);if((d=this.state())==="destroying"||d==="destroyed"){typeof b=="function"&&b(new Error("Can't load a destroyed record!"));return}return this.loading(),this._doStorageOperation("read",a,function(a,c){return a||(e.loaded(),c=e.constructor._mapIdentity(c)),typeof b=="function"?b(a,c):void 0})},j.prototype.save=function(a,b){var c,d,e=this;b||(c=[{},a],a=c[0],b=c[1]);if((d=this.state())==="destroying"||d==="destroyed"){typeof b=="function"&&b(new Error("Can't save a destroyed record!"));return}return this.validate(function(c,d){var f,g,h;if(!c){typeof b=="function"&&b(d);return}return g=e.isNew(),e.saving(),g&&e.creating(),f=e.constructor._batman.get("associations"),f!=null&&(h=f.getByType("belongsTo"))!=null&&h.forEach(function(a,b){return a.apply(e)}),e._doStorageOperation(g?"create":"update",a,function(a,c){var d,h;return a||(g&&e.created(),e.saved(),e.dirtyKeys.clear(),f!=null&&(d=f.getByType("hasOne"))!=null&&d.forEach(function(b){return b.apply(a,c)}),f!=null&&(h=f.getByType("hasMany"))!=null&&h.forEach(function(b){return b.apply(a,c)}),c=e.constructor._mapIdentity(c)),typeof b=="function"?b(a,c):void 0})})},j.prototype.destroy=function(a,b){var c,d=this;return b||(c=[{},a],a=c[0],b=c[1]),this.destroying(),this._doStorageOperation("destroy",a,function(a,c){return a||(d.constructor.get("loaded").remove(d),d.destroyed()),typeof b=="function"?b(a):void 0})},j.prototype.validate=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o=this;e=this.state(),this.errors.clear(),this.validating(),c=function(){return o.validated(),o[e](),typeof a=="function"?a(o.errors.length===0,o.errors):void 0},i=this._batman.get("validators")||[];if(i.length>0){b=i.length,g=function(){if(--b===0)return c()};for(j=0,l=i.length;j<l;j++){h=i[j],f=h.validator,n=h.keys;for(k=0,m=n.length;k<m;k++)d=n[k],f?f.validateEach(this.errors,this,d,g):h.callback(this.errors,this,d,g)}}else c()},j.prototype.associationProxy=function(a){var b,c,d;return E.initializeObject(this),b=(c=this._batman).associationProxies||(c.associationProxies={}),b[d=a.label]||(b[d]=new a.proxyClass(a,this)),b[a.label]},j}(E.Object),E.AssociationProxy=function(a){function b(a,b){this.association=a,this.model=b}return W(b,a),b.name="AssociationProxy",b.prototype.isProxy=!0,b.prototype.loaded=!1,b.prototype.toJSON=function(){var a;a=this.get("target");if(a!=null)return this.get("target").toJSON()},b.prototype.load=function(a){var b=this;return this.fetch(function(c,d){return c||(b.set("loaded",!0),b.set("target",d)),typeof a=="function"?a(c,d):void 0}),this.get("target")},b.prototype.fetch=function(a){var b;return(this.get("foreignValue")||this.get("primaryValue"))==null?a(void 0,void 0):(b=this.fetchFromLocal(),b?a(void 0,b):this.fetchFromRemote(a))},b.accessor("loaded",E.Property.defaultAccessor),b.accessor("target",{get:function(){return this.fetchFromLocal()},set:function(a,b){return b}}),b.accessor({get:function(a){var b;return(b=this.get("target"))!=null?b.get(a):void 0},set:function(a,b){var c;return(c=this.get("target"))!=null?c.set(a,b):void 0}}),b}(E.Object),E.BelongsToProxy=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="BelongsToProxy",b.accessor("foreignValue",function(){return this.model.get(this.association.foreignKey)}),b.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("foreignValue"))},b.prototype.fetchFromRemote=function(a){var b=this;return this.association.getRelatedModel().find(this.get("foreignValue"),function(b,c){if(b)throw b;return a(void 0,c)})},b}(E.AssociationProxy),E.PolymorphicBelongsToProxy=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="PolymorphicBelongsToProxy",b.accessor("foreignTypeValue",function(){return this.model.get(this.association.foreignTypeKey)}),b.prototype.fetchFromLocal=function(){return this.association.setIndexForType(this.get("foreignTypeValue")).get(this.get("foreignValue"))},b.prototype.fetchFromRemote=function(a){var b=this;return this.association.getRelatedModelForType(this.get("foreignTypeValue")).find(this.get("foreignValue"),function(b,c){if(b)throw b;return a(void 0,c)})},b}(E.BelongsToProxy),E.HasOneProxy=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="HasOneProxy",b.accessor("primaryValue",function(){return this.model.get(this.association.primaryKey)}),b.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("primaryValue"))},b.prototype.fetchFromRemote=function(a){var b,c=this;return b={},b[this.association.foreignKey]=this.get("primaryValue"),this.association.getRelatedModel().load(b,function(b,c){if(b)throw b;return!c||c.length<=0?a(new Error("Couldn't find related record!"),void 0):a(void 0,c[0])})},b}(E.AssociationProxy),E.AssociationSet=function(a){function b(a,c){var d;this.foreignKeyValue=a,this.association=c,d=new E.Set,b.__super__.constructor.call(this,d,"hashKey")}return W(b,a),b.name="AssociationSet",b.prototype.loaded=!1,b.prototype.load=function(a){var b=this;return this.foreignKeyValue==null?a(void 0,this):this.association.getRelatedModel().load(this._getLoadOptions(),function(c,d){return c||(b.loaded=!0),b.fire("loaded"),a(c,b)})},b.prototype._getLoadOptions=function(){var a;return a={},a[this.association.foreignKey]=this.foreignKeyValue,a},b}(E.SetSort),E.UniqueAssociationSetIndex=function(a){function b(a,c){this.association=a,b.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),c)}return W(b,a),b.name="UniqueAssociationSetIndex",b}(E.UniqueSetIndex),E.AssociationSetIndex=function(a){function b(a,c){this.association=a,b.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),c)}return W(b,a),b.name="AssociationSetIndex",b.prototype._resultSetForKey=function(a){var b=this;return this._storage.getOrSet(a,function(){return new E.AssociationSet(a,b.association)})},b.prototype._setResultSet=function(a,b){return this._storage.set(a,b)},b}(E.SetIndex),E.PolymorphicUniqueAssociationSetIndex=function(a){function b(a,c,d){this.association=a,this.type=c,b.__super__.constructor.call(this,this.association.getRelatedModelForType(c).get("loaded"),d)}return W(b,a),b.name="PolymorphicUniqueAssociationSetIndex",b}(E.UniqueSetIndex),E.PolymorphicAssociationSetIndex=function(a){function b(a,c,d){this.association=a,this.type=c,b.__super__.constructor.call(this,this.association.getRelatedModelForType(c).get("loaded"),d)}return W(b,a),b.name="PolymorphicAssociationSetIndex",b.prototype._resultSetForKey=function(a){var b=this;return this._storage.getOrSet(a,function(){return new E.PolymorphicAssociationSet(a,b.type,b.association)})},b}(E.SetIndex),E.PolymorphicAssociationSet=function(a){function b(a,c,d){this.foreignKeyValue=a,this.foreignTypeKeyValue=c,this.association=d,b.__super__.constructor.call(this,this.foreignKeyValue,this.association)}return W(b,a),b.name="PolymorphicAssociationSet",b.prototype._getLoadOptions=function(){var a;return a={},a[this.association.foreignKey]=this.foreignKeyValue,a[this.association.foreignTypeKey]=this.foreignTypeKeyValue,a},b}(E.AssociationSet),E.AssociationCurator=function(a){function b(a){this.model=a,b.__super__.constructor.call(this),this._byTypeStorage=new E.SimpleHash}return W(b,a),b.name="AssociationCurator",b.availableAssociations=["belongsTo","hasOne","hasMany"],b.prototype.add=function(a){var b;return this.set(a.label,a),(b=this._byTypeStorage.get(a.associationType))||(b=new E.SimpleSet,this._byTypeStorage.set(a.associationType,b)),b.add(a)},b.prototype.getByType=function(a){return this._byTypeStorage.get(a)},b.prototype.getByLabel=function(a){return this.get(a)},b.prototype.reset=function(){return this.forEach(function(a,b){return b.reset()}),!0},b.prototype.merge=function(){var a,c;return a=1<=arguments.length?T.call(arguments,0):[],c=b.__super__.merge.apply(this,arguments),c._byTypeStorage=this._byTypeStorage.merge(a.map(function(a){return a._byTypeStorage})),c},b}(E.SimpleHash),E.Association=function(){function a(a,b,c){var d,e,f,g;this.model=a,this.label=b,c==null&&(c={}),d={namespace:E.currentApp,name:L.camelize(L.singularize(this.label))},this.options=o(d,this.defaultOptions,c),this.model.encode(b,this.encoder()),f=this,e=function(){return f.getAccessor.call(this,f,this.model,this.label)},this.model.accessor(this.label,{get:e,set:a.defaultAccessor.set,unset:a.defaultAccessor.unset}),this.url&&((g=this.model).url||(g.url=function(a){return f.url(a)}))}return a.name="Association",a.prototype.associationType="",a.prototype.isPolymorphic=!1,a.prototype.defaultOptions={saveInline:!0,autoload:!0},a.prototype.getRelatedModel=function(){var a,b,c;return c=this.options.namespace||E.currentApp,a=this.options.name,b=c!=null?c[a]:void 0,K["do"](function(){if(E.currentApp!=null&&!b)return K.warn("Related model "+a+" hasn't loaded yet.")}),b},a.prototype.getFromAttributes=function(a){return a.constructor.defaultAccessor.get.call(a,this.label)},a.prototype.setIntoAttributes=function(a,b){return a.constructor.defaultAccessor.set.call(a,this.label,b)},a.prototype.encoder=function(){return K.error("You must override encoder in Batman.Association subclasses.")},a.prototype.setIndex=function(){return K.error("You must override setIndex in Batman.Association subclasses.")},a.prototype.inverse=function(){var a,b,c=this;if(b=this.getRelatedModel()._batman.get("associations"))return this.options.inverseOf?b.getByLabel(this.options.inverseOf):(a=null,b.forEach(function(b,d){if(d.getRelatedModel()===c.model)return a=d}),a)},a.prototype.reset=function(){return delete this.index,!0},a}(),E.SingularAssociation=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="SingularAssociation",b.prototype.isSingular=!0,b.prototype.getAccessor=function(a,b,c){var d,e;if(e=a.getFromAttributes(this))return e;if(a.getRelatedModel())return d=this.associationProxy(a),E.Property.withoutTracking(function(){if(!d.get("loaded")&&a.options.autoload)return d.load()}),d},b.prototype.setIndex=function(){return this.index||(this.index=new E.UniqueAssociationSetIndex(this,this[this.indexRelatedModelOn])),this.index},b}(E.Association),E.PluralAssociation=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="PluralAssociation",b.prototype.isSingular=!1,b.prototype.setForRecord=function(a){var b=this;return E.Property.withoutTracking(function(){var c;return(c=a.get(b.primaryKey))?b.setIndex().get(c):new E.AssociationSet(void 0,b)})},b.prototype.getAccessor=function(a,b,c){var d,e,f=this;if(!a.getRelatedModel())return;return(e=a.getFromAttributes(this))?e:(d=a.setForRecord(this),a.setIntoAttributes(this,d),E.Property.withoutTracking(function(){if(a.options.autoload&&!f.isNew()&&!d.loaded)return d.load(function(a,b){if(a)throw a})}),d)},b.prototype.setIndex=function(){return this.index||(this.index=new E.AssociationSetIndex(this,this[this.indexRelatedModelOn])),this.index},b}(E.Association),E.BelongsToAssociation=function(a){function b(a,c,d){if(d!=null?d.polymorphic:void 0)return delete d.polymorphic,function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b),f=typeof e;return f=="object"||f=="function"?e||d:d}(E.PolymorphicBelongsToAssociation,arguments,function(){});b.__super__.constructor.apply(this,arguments),this.foreignKey=this.options.foreignKey||""+this.label+"_id",this.primaryKey=this.options.primaryKey||"id",this.model.encode(this.foreignKey)}return W(b,a),b.name="BelongsToAssociation",b.prototype.associationType="belongsTo",b.prototype.proxyClass=E.BelongsToProxy,b.prototype.indexRelatedModelOn="primaryKey",b.prototype.defaultOptions={saveInline:!1,autoload:!0},b.prototype.url=function(a){var b,c,d,e,f,g;if(e=this.inverse())return f=E.helpers.pluralize(this.label),d=(g=a.data)!=null?g[this.foreignKey]:void 0,c=e.isSingular?"singularize":"pluralize",b=E.helpers[c](e.label),"/"+f+"/"+d+"/"+b},b.prototype.encoder=function(){var a,b;return a=this,b={encode:!1,decode:function(b,c,d,e,f){var g,h,i;return i=a.getRelatedModel(),h=new i,h.fromJSON(b),h=i._mapIdentity(h),a.options.inverseOf&&(g=a.inverse())&&(g instanceof E.HasManyAssociation?f.set(a.foreignKey,h.get(a.primaryKey)):h.set(g.label,f)),f.set(a.label,h),h}},this.options.saveInline&&(b.encode=function(a){return a.toJSON()}),b},b.prototype.apply=function(a){var b,c;if(c=a.get(this.label)){b=c.get(this.primaryKey);if(b!==void 0)return a.set(this.foreignKey,b)}},b}(E.SingularAssociation),E.PolymorphicBelongsToAssociation=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.foreignTypeKey=this.options.foreignTypeKey||""+this.label+"_type",this.model.encode(this.foreignTypeKey),this.typeIndicies={}}return W(b,a),b.name="PolymorphicBelongsToAssociation",b.prototype.isPolymorphic=!0,b.prototype.proxyClass=E.PolymorphicBelongsToProxy,b.prototype.getRelatedModel=!1,b.prototype.setIndex=!1,b.prototype.inverse=!1,b.prototype.apply=function(a){var c,d,e;b.__super__.apply.apply(this,arguments);if(d=a.get(this.label))return d instanceof E.AssociationProxy?e=d.association.model:e=d.constructor,c=i(e),a.set(this.foreignTypeKey,c)},b.prototype.getAccessor=function(a,b,c){var d,e;if(e=a.getFromAttributes(this))return e;if(a.getRelatedModelForType(this.get(a.foreignTypeKey)))return d=this.associationProxy(a),E.Property.withoutTracking(function(){if(!d.get("loaded")&&a.options.autoload)return d.load()}),d},b.prototype.url=function(a){var b,c,d,e,f,g,h,i;g=(h=a.data)!=null?h[this.foreignTypeKey]:void 0;if(g&&(e=this.inverseForType(g)))return f=E.helpers.pluralize(g).toLowerCase(),d=(i=a.data)!=null?i[this.foreignKey]:void 0,c=e.isSingular?"singularize":"pluralize",b=E.helpers[c](e.label),"/"+f+"/"+d+"/"+b},b.prototype.getRelatedModelForType=function(a){var b,c;return c=this.options.namespace||E.currentApp,b=c!=null?c[a]:void 0,K["do"](function(){if(E.currentApp!=null&&!b)return K.warn("Related model "+modelName+" for polymorhic association not found.")}),b},b.prototype.setIndexForType=function(a){var b;return(b=this.typeIndicies)[a]||(b[a]=new E.PolymorphicUniqueAssociationSetIndex(this,a,this.primaryKey)),this.typeIndicies[a]},b.prototype.inverseForType=function(a){var b,c,d,e=this;if(c=(d=this.getRelatedModelForType(a))!=null?d._batman.get("associations"):void 0)return this.options.inverseOf?c.getByLabel(this.options.inverseOf):(b=null,c.forEach(function(a,c){if(c.getRelatedModel()===e.model)return b=c}),b)},b.prototype.encoder=function(){var a,b;return a=this,b={encode:!1,decode:function(b,c,d,e,f){var g,h,i,j;return g=d[a.foreignTypeKey]||f.get(a.foreignTypeKey),j=a.getRelatedModelForType(g),i=new j,i.fromJSON(b),i=j._mapIdentity(i),a.options.inverseOf&&(h=a.inverseForType(g))&&(h instanceof E.PolymorphicHasManyAssociation?(f.set(a.foreignKey,i.get(a.primaryKey)),f.set(a.foreignTypeKey,g)):i.set(h.label,f)),f.set(a.label,i),i}},this.options.saveInline&&(b.encode=function(a){return a.toJSON()}),b},b}(E.BelongsToAssociation),E.HasOneAssociation=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.primaryKey=this.options.primaryKey||"id",this.foreignKey=this.options.foreignKey||""+L.underscore(i(this.model))+"_id"}return W(b,a),b.name="HasOneAssociation",b.prototype.associationType="hasOne",b.prototype.proxyClass=E.HasOneProxy,b.prototype.indexRelatedModelOn="foreignKey",b.prototype.apply=function(a,b){var c;if(c=this.getFromAttributes(b))return c.set(this.foreignKey,b.get(this.primaryKey))},b.prototype.encoder=function(){var a;return a=this,{encode:function(b,c,d,e){var f;if(!a.options.saveInline)return;if(f=b.toJSON())f[a.foreignKey]=e.get(a.primaryKey);return f},decode:function(b,c,d,e,f){var g,h;return h=a.getRelatedModel(),g=new h,g.fromJSON(b),a.options.inverseOf&&g.set(a.options.inverseOf,f),g=h._mapIdentity(g),g}}},b}(E.SingularAssociation),E.HasManyAssociation=function(a){function b(a,c,d){if(d!=null?d.as:void 0)return function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b),f=typeof e;return f=="object"||f=="function"?e||d:d}(E.PolymorphicHasManyAssociation,arguments,function(){});b.__super__.constructor.apply(this,arguments),this.primaryKey=this.options.primaryKey||"id",this.foreignKey=this.options.foreignKey||""+L.underscore(i(this.model))+"_id"}return W(b,a),b.name="HasManyAssociation",b.prototype.associationType="hasMany",b.prototype.indexRelatedModelOn="foreignKey",b.prototype.apply=function(a,b){var c,d=this;if(!a)return(c=this.getFromAttributes(b))&&c.forEach(function(a){return a.set(d.foreignKey,b.get(d.primaryKey))}),b.set(this.label,this.setForRecord(b))},b.prototype.encoder=function(){var a;return a=this,{encode:function(b,c,d,e){var f;if(a._beingEncoded)return;a._beingEncoded=!0;if(!a.options.saveInline)return;return b!=null&&(f=[],b.forEach(function(b){var c;return c=b.toJSON(),c[a.foreignKey]=e.get(a.primaryKey),f.push(c)})),delete a._beingEncoded,f},decode:function(b,c,d,e,f){var g,h,i,j,k,l,m,n,o;if(m=a.getRelatedModel()){i=a.getFromAttributes(f)||a.setForRecord(f),h=i!=null?i.toArray():void 0;for(j=n=0,o=b.length;n<o;j=++n)k=b[j],l=h&&h[j]?(g=!0,h[j]):(g=!1,new m),l.fromJSON(k),a.options.inverseOf&&l.set(a.options.inverseOf,f),l=m._mapIdentity(l),i.add(l);i.set("loaded",!0)}else K.error("Can't decode model "+a.options.name+" because it hasn't been loaded yet!");return i}}},b}(E.PluralAssociation),E.PolymorphicHasManyAssociation=function(a){function b(a,c,d){d.inverseOf=this.foreignLabel=d.as,delete d.as,d.foreignKey||(d.foreignKey=""+this.foreignLabel+"_id"),b.__super__.constructor.call(this,a,c,d),this.foreignTypeKey=d.foreignTypeKey||""+this.foreignLabel+"_type",this.model.encode(this.foreignTypeKey)}return W(b,a),b.name="PolymorphicHasManyAssociation",b.prototype.isPolymorphic=!0,b.prototype.apply=function(a,c){var d,e=this;return!a&&(d=this.getFromAttributes(c))&&(b.__super__.apply.apply(this,arguments),d.forEach(function(a){return a.set(e.foreignTypeKey,e.modelType())})),!0},b.prototype.getRelatedModelForType=function(){return this.getRelatedModel()},b.prototype.modelType=function(){return i(this.model)},b.prototype.setIndex=function(){return this.typeIndex||(this.typeIndex=new E.PolymorphicAssociationSetIndex(this,this.modelType(),this[this.indexRelatedModelOn])),this.typeIndex},b.prototype.encoder=function(){var a,c;return a=this,c=b.__super__.encoder.apply(this,arguments),c.encode=function(b,c,d,e){var f;if(a._beingEncoded
)return;a._beingEncoded=!0;if(!a.options.saveInline)return;return b!=null&&(f=[],b.forEach(function(b){var c;return c=b.toJSON(),c[a.foreignKey]=e.get(a.primaryKey),c[a.foreignTypeKey]=a.modelType(),f.push(c)})),delete a._beingEncoded,f},c},b}(E.HasManyAssociation),function(){var a,b,c,d,e,f=this;d=E.AssociationCurator.availableAssociations,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(function(a){return E.Model[a]=function(b,c){var d,e;return E.initializeObject(this),d=(e=this._batman).associations||(e.associations=new E.AssociationCurator(this)),d.add(new(E[""+L.capitalize(a)+"Association"])(this,b,c))}}(a));return e}(),E.ValidationError=function(a){function b(a,c){b.__super__.constructor.call(this,{attribute:a,message:c})}return W(b,a),b.name="ValidationError",b}(E.Object),E.ErrorsSet=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="ErrorsSet",b.accessor(function(a){return this.indexedBy("attribute").get(a)}),b.prototype.add=function(a,c){return b.__super__.add.call(this,new E.ValidationError(a,c))},b}(E.Set),E.Validator=function(a){function b(){var a;options=arguments[0],a=2<=arguments.length?T.call(arguments,1):[],this.options=options,b.__super__.constructor.apply(this,a)}return W(b,a),b.name="Validator",b.prototype.validate=function(a){return K.error("You must override validate in Batman.Validator subclasses.")},b.prototype.format=function(a,b,c){return M("errors.format",{attribute:a,message:M("errors.messages."+b,c)})},b.options=function(){var a;return a=1<=arguments.length?T.call(arguments,0):[],E.initializeObject(this),this._batman.options?this._batman.options.concat(a):this._batman.options=a},b.matches=function(a){var b,c,d,e,f,g;c={},d=!1;for(b in a)e=a[b],~((f=this._batman)!=null?(g=f.options)!=null?g.indexOf(b):void 0:void 0)&&(c[b]=e,d=!0);if(d)return c},b}(E.Object),G=E.Validators=[E.LengthValidator=function(a){function b(a){var c;if(c=a.lengthIn||a.lengthWithin)a.minLength=c[0],a.maxLength=c[1]||-1,delete a.lengthWithin,delete a.lengthIn;b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="LengthValidator",b.options("minLength","maxLength","length","lengthWithin","lengthIn"),b.prototype.validateEach=function(a,b,c,d){var e,f,g;return e=this.options,f=(g=b.get(c))!=null?g:[],e.minLength&&f.length<e.minLength&&a.add(c,this.format(c,"too_short",{count:e.minLength})),e.maxLength&&f.length>e.maxLength&&a.add(c,this.format(c,"too_long",{count:e.maxLength})),e.length&&f.length!==e.length&&a.add(c,this.format(c,"wrong_length",{count:e.length})),d()},b}(E.Validator),E.NumericValidator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="NumericValidator",b.options("numeric"),b.prototype.validateEach=function(a,b,c,d){var e;return e=b.get(c),this.options.numeric&&isNaN(parseFloat(e))&&a.add(c,this.format(c,"not_numeric")),d()},b}(E.Validator),E.PresenceValidator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="PresenceValidator",b.options("presence"),b.prototype.validateEach=function(a,b,c,d){var e;return e=b.get(c),this.options.presence&&(e==null||e==="")&&a.add(c,this.format(c,"blank")),d()},b}(E.Validator)],o(E.translate.messages,{errors:{format:"%{attribute} %{message}",messages:{too_short:"must be at least %{count} characters",too_long:"must be less than %{count} characters",wrong_length:"must be %{count} characters",blank:"can't be blank",not_numeric:"must be a number"}}}),E.StorageAdapter=function(a){function b(a){b.__super__.constructor.call(this,{model:a})}return W(b,a),b.name="StorageAdapter",b.StorageError=function(a){function b(a){b.__super__.constructor.apply(this,arguments),this.message=a}return W(b,a),b.name="StorageError",b.prototype.name="StorageError",b}(Error),b.RecordExistsError=function(a){function b(a){b.__super__.constructor.call(this,a||"Can't create this record because it already exists in the store!")}return W(b,a),b.name="RecordExistsError",b.prototype.name="RecordExistsError",b}(b.StorageError),b.NotFoundError=function(a){function b(a){b.__super__.constructor.call(this,a||"Record couldn't be found in storage!")}return W(b,a),b.name="NotFoundError",b.prototype.name="NotFoundError",b}(b.StorageError),b.prototype.isStorageAdapter=!0,b.prototype.storageKey=function(a){var b;return b=(a!=null?a.constructor:void 0)||this.model,b.get("storageKey")||L.pluralize(L.underscore(i(b)))},b.prototype.getRecordFromData=function(a,b){var c;return b==null&&(b=this.model),c=new b,c.fromJSON(a),c},b.skipIfError=function(a){return function(b,c){return b.error!=null?c():a.call(this,b,c)}},b.prototype.before=function(){return this._addFilter.apply(this,["before"].concat(T.call(arguments)))},b.prototype.after=function(){return this._addFilter.apply(this,["after"].concat(T.call(arguments)))},b.prototype._inheritFilters=function(){var a,b,c,d,e,f;if(!this._batman.check(this)||!this._batman.filters){d=this._batman.getFirst("filters"),this._batman.filters={before:{},after:{}};if(d!=null){f=[];for(e in d)a=d[e],f.push(function(){var d;d=[];for(c in a)b=a[c],d.push(this._batman.filters[e][c]=b.slice(0));return d}.call(this));return f}}},b.prototype._addFilter=function(){var a,b,c,d,e,f,g,h;d=arguments[0],c=3<=arguments.length?T.call(arguments,1,f=arguments.length-1):(f=1,[]),a=arguments[f++],this._inheritFilters();for(g=0,h=c.length;g<h;g++)b=c[g],(e=this._batman.filters[d])[b]||(e[b]=[]),this._batman.filters[d][b].push(a);return!0},b.prototype.runFilter=function(a,b,c,d){var e,f,g,h,i=this;return this._inheritFilters(),f=this._batman.filters[a].all||[],e=this._batman.filters[a][b]||[],c.action=b,g=e.concat(f),h=function(a){var b;return a!=null&&(c=a),(b=g.shift())!=null?b.call(i,c,h):d.call(i,c)},h()},b.prototype.runBeforeFilter=function(){return this.runFilter.apply(this,["before"].concat(T.call(arguments)))},b.prototype.runAfterFilter=function(a,b,c){return this.runFilter("after",a,b,this.exportResult(c))},b.prototype.exportResult=function(a){return function(b){return a(b.error,b.result,b)}},b.prototype._jsonToAttributes=function(a){return JSON.parse(a)},b.prototype.perform=function(a,b,c,d){var e,f,g=this;return c||(c={}),e={options:c},a==="readAll"?e.proto=b:e.record=b,f=function(b){return b!=null&&(e=b),g.runAfterFilter(a,e,d)},this.runBeforeFilter(a,e,function(b){return this[a](b,f)})},b}(E.Object),E.LocalStorage=function(a){function b(){if(typeof window.localStorage=="undefined")return null;b.__super__.constructor.apply(this,arguments),this.storage=localStorage}return W(b,a),b.name="LocalStorage",b.prototype.storageRegExpForRecord=function(a){return new RegExp("^"+this.storageKey(a)+"(\\d+)$")},b.prototype.nextIdForRecord=function(a){var b,c;return c=this.storageRegExpForRecord(a),b=1,this._forAllStorageEntries(function(a,d){var e;if(e=c.exec(a))return b=Math.max(b,parseInt(e[1],10)+1)}),b},b.prototype._forAllStorageEntries=function(a){var b,c,d,e;for(b=d=0,e=this.storage.length;0<=e?d<e:d>e;b=0<=e?++d:--d)c=this.storage.key(b),a.call(this,c,this.storage.getItem(c));return!0},b.prototype._storageEntriesMatching=function(a,b){var c,d;return c=this.storageRegExpForRecord(a),d=[],this._forAllStorageEntries(function(e,f){var g,h;if(h=c.exec(e)){g=this._jsonToAttributes(f),g[a.constructor.primaryKey]=h[1];if(this._dataMatches(b,g))return d.push(g)}}),d},b.prototype._dataMatches=function(a,b){var c,d,e;d=!0;for(c in a){e=a[c];if(b[c]!==e){d=!1;break}}return d},b.prototype.before("read","create","update","destroy",b.skipIfError(function(a,b){return a.action==="create"?a.id=a.record.get("id")||a.record.set("id",this.nextIdForRecord(a.record)):a.id=a.record.get("id"),a.id==null?a.error=new this.constructor.StorageError("Couldn't get/set record primary key on "+a.action+"!"):a.key=this.storageKey(a.record)+a.id,b()})),b.prototype.before("create","update",b.skipIfError(function(a,b){return a.recordAttributes=JSON.stringify(a.record),b()})),b.prototype.after("read",b.skipIfError(function(a,b){if(typeof a.recordAttributes=="string")try{a.recordAttributes=this._jsonToAttributes(a.recordAttributes)}catch(c){return a.error=c,b()}return a.record.fromJSON(a.recordAttributes),b()})),b.prototype.after("read","create","update","destroy",b.skipIfError(function(a,b){return a.result=a.record,b()})),b.prototype.after("readAll",b.skipIfError(function(a,b){var c;return a.result=a.records=function(){var b,d,e,f;e=a.recordsAttributes,f=[];for(b=0,d=e.length;b<d;b++)c=e[b],f.push(this.getRecordFromData(c,a.proto.constructor));return f}.call(this),b()})),b.prototype.read=b.skipIfError(function(a,b){return a.recordAttributes=this.storage.getItem(a.key),a.recordAttributes||(a.error=new this.constructor.NotFoundError),b()}),b.prototype.create=b.skipIfError(function(a,b){var c,d;return c=a.key,d=a.recordAttributes,this.storage.getItem(c)?arguments[0].error=new this.constructor.RecordExistsError:this.storage.setItem(c,d),b()}),b.prototype.update=b.skipIfError(function(a,b){var c,d;return c=a.key,d=a.recordAttributes,this.storage.setItem(c,d),b()}),b.prototype.destroy=b.skipIfError(function(a,b){var c;return c=a.key,this.storage.removeItem(c),b()}),b.prototype.readAll=b.skipIfError(function(a,b){var c,d;d=a.proto,c=a.options;try{arguments[0].recordsAttributes=this._storageEntriesMatching(d,c.data)}catch(e){arguments[0].error=e}return b()}),b}(E.StorageAdapter),E.SessionStorage=function(a){function b(){if(typeof window.sessionStorage=="undefined")return null;b.__super__.constructor.apply(this,arguments),this.storage=sessionStorage}return W(b,a),b.name="SessionStorage",b}(E.LocalStorage),E.RestStorage=function(a){function h(){h.__super__.constructor.apply(this,arguments),this.defaultRequestOptions=o({},this.defaultRequestOptions)}var b,c,d,e,f,g=this;W(h,a),h.name="RestStorage",h.JSONContentType="application/json",h.PostBodyContentType="application/x-www-form-urlencoded",h.prototype.defaultRequestOptions={type:"json"},h.prototype.serializeAsForm=!0,h.prototype.recordJsonNamespace=function(a){return L.singularize(this.storageKey(a))},h.prototype.collectionJsonNamespace=function(a){return L.pluralize(this.storageKey(a))},h.prototype._execWithOptions=function(a,b,c){return typeof a[b]=="function"?a[b](c):a[b]},h.prototype._defaultCollectionUrl=function(a){return"/"+this.storageKey(a)},h.prototype.urlForRecord=function(a,b){var c,d;if(a.url)d=this._execWithOptions(a,"url",b.options);else{d=a.constructor.url?this._execWithOptions(a.constructor,"url",b.options):this._defaultCollectionUrl(a);if(b.action!=="create"){if((c=a.get("id"))==null)throw new this.constructor.StorageError("Couldn't get/set record primary key on "+b.action+"!");d=d+"/"+c}}return this.urlPrefix(a,b)+d+this.urlSuffix(a,b)},h.prototype.urlForCollection=function(a,b){var c;return c=a.url?this._execWithOptions(a,"url",b.options):this._defaultCollectionUrl(a.prototype,b.options),this.urlPrefix(a,b)+c+this.urlSuffix(a,b)},h.prototype.urlPrefix=function(a,b){return this._execWithOptions(a,"urlPrefix",b.options)||""},h.prototype.urlSuffix=function(a,b){return this._execWithOptions(a,"urlSuffix",b.options)||""},h.prototype.request=function(a,b){var c,d;return c=o(a.options,{success:function(b){return a.data=b},error:function(b){return a.error=b},loaded:function(){return a.response=d.get("response"),b()}}),d=new E.Request(c)},h.prototype.perform=function(a,b,c,d){return o(c||(c={}),this.defaultRequestOptions),h.__super__.perform.apply(this,arguments)},h.prototype.before("create","read","update","destroy",h.skipIfError(function(a,b){try{a.options.url=this.urlForRecord(a.record,a)}catch(c){a.error=c}return b()})),h.prototype.before("readAll",h.skipIfError(function(a,b){try{a.options.url=this.urlForCollection(a.proto.constructor,a)}catch(c){a.error=c}return b()})),h.prototype.before("create","update",h.skipIfError(function(a,b){var c,d,e;return d=a.record.toJSON(),(e=this.recordJsonNamespace(a.record))?(c={},c[e]=d):c=d,this.serializeAsForm?a.options.contentType=this.constructor.PostBodyContentType:(c=JSON.stringify(c),a.options.contentType=this.constructor.JSONContentType),a.options.data=c,b()})),h.prototype.after("create","read","update",h.skipIfError(function(a,b){var c,d;if(a.data==null)return b();if(typeof a.data=="string"){if(a.data.length>0)try{c=this._jsonToAttributes(a.data)}catch(e){return a.error=e,b()}}else c=a.data;return c!=null&&(d=this.recordJsonNamespace(a.record),d&&c[d]!=null&&(c=c[d]),a.record.fromJSON(c)),a.result=a.record,b()})),h.prototype.after("readAll",h.skipIfError(function(a,b){var c,d;if(typeof a.data=="string")try{a.data=JSON.parse(a.data)}catch(e){return a.error=e,b()}return d=this.collectionJsonNamespace(a.proto),a.recordsAttributes=d&&a.data[d]!=null?a.data[d]:a.data,a.result=a.records=function(){var b,d,e,f;e=a.recordsAttributes,f=[];for(b=0,d=e.length;b<d;b++)c=e[b],f.push(this.getRecordFromData(c,a.proto.constructor));return f}.call(this),b()})),h.HTTPMethods={create:"POST",update:"PUT",read:"GET",readAll:"GET",destroy:"DELETE"},f=["create","read","update","destroy","readAll"],c=function(a){return h.prototype[a]=h.skipIfError(function(b,c){return b.options.method=this.constructor.HTTPMethods[a],this.request(b,c)})};for(d=0,e=f.length;d<e;d++)b=f[d],c(b);return h}.call(this,E.StorageAdapter),E.ViewStore=function(a){function b(){b.__super__.constructor.apply(this,arguments),this._viewContents={},this._requestedPaths=new E.SimpleSet}return W(b,a),b.name="ViewStore",b.prefix="views",b.prototype.propertyClass=E.Property,b.prototype.fetchView=function(a){var b=this;return K["do"](function(){if(typeof E.View.prototype.prefix!="undefined")return K.warn("Batman.View.prototype.prefix has been removed, please use Batman.ViewStore.prefix instead.")}),new E.Request({url:E.Navigator.normalizePath(this.constructor.prefix,""+a+".html"),type:"html",success:function(c){return b.set(a,c)},error:function(b){throw new Error("Could not load view from "+a)}})},b.accessor({"final":!0,get:function(a){if(a[0]!=="/")return this.get("/"+a);if(this._viewContents[a])return this._viewContents[a];if(this._requestedPaths.has(a))return;this.fetchView(a)},set:function(a,b){return a[0]!=="/"?this.set("/"+a,b):(this._requestedPaths.add(a),this._viewContents[a]=b)}}),b.prototype.prefetch=function(a){return this.get(a),!0},b}(E.Object),E.View=function(a){function b(a){var c,d=this;a==null&&(a={}),c=a.context,c?c instanceof E.RenderContext||(c=E.RenderContext.root().descend(c)):c=E.RenderContext.root(),a.context=c.descend(this),b.__super__.constructor.call(this,a),E.Property.withoutTracking(function(){var a;return(a=d.get("node"))?d.render(a):d.observe("node",function(a){return d.render(a)})})}return W(b,a),b.name="View",b.prototype.isView=!0,b.store=new E.ViewStore,b.prototype.source="",b.prototype.html="",b.prototype.node=null,b.prototype.event("ready").oneShot=!0,b.accessor("html",{get:function(){var a;if(this.html&&this.html.length>0)return this.html;if(!(a=this.get("source")))return;return a=E.Navigator.normalizePath(a),this.html=this.constructor.store.get(a)},set:function(a,b){return this.html=b}}),b.accessor("node",{get:function(){var a;if(!this.node){a=this.get("html");if(!(a&&a.length>0))return;this.hasContainer=!0,this.node=document.createElement("div"),w(this.node,a),this.node.children.length>0&&E.data(this.node.children[0],"view",this)}return this.node},set:function(a,b){var c,d=this;return this.node=b,E.data(this.node,"view",this),c=function(a){if(a!=null)return w(d.get("node"),a),d.forget("html",c)},this.observeAndFire("html",c)}}),b.prototype.render=function(a){var b=this;this.event("ready").resetOneShot();if(a)return this._renderer=new E.Renderer(a,null,this.context,this),this._renderer.on("rendered",function(){return b.fire("ready",a)})},b.prototype.on("appear",function(){return typeof this.viewDidAppear=="function"?this.viewDidAppear.apply(this,arguments):void 0}),b.prototype.on("disappear",function(){return typeof this.viewDidDisappear=="function"?this.viewDidDisappear.apply(this,arguments):void 0}),b.prototype.on("beforeAppear",function(){return typeof this.viewWillAppear=="function"?this.viewWillAppear.apply(this,arguments):void 0}),b.prototype.on("beforeDisappear",function(){return typeof this.viewWillDisappear=="function"?this.viewWillDisappear.apply(this,arguments):void 0}),b}(E.Object),E.Renderer=function(a){function o(a,b,c,d){this.node=a,this.context=c,this.resume=X(this.resume,this),this.start=X(this.start,this),o.__super__.constructor.call(this),b!=null&&this.on("parsed",b),this.context instanceof E.RenderContext||K.error("Must pass a RenderContext to a renderer for rendering"),this.immediate=v(this.start)}var b,d,e,f,g,i,j,k,l,m,n;W(o,a),o.name="Renderer",o.prototype.deferEvery=50,o.prototype.start=function(){return this.startTime=new Date,this.parseNode(this.node)},o.prototype.resume=function(){return this.startTime=new Date,this.parseNode(this.resumeNode)},o.prototype.finish=function(){return this.startTime=null,this.prevent("stopped"),this.fire("parsed"),this.fire("rendered")},o.prototype.stop=function(){return c(this.immediate),this.fire("stopped")},n=["parsed","rendered","stopped"];for(j=0,l=n.length;j<l;j++)f=n[j],o.prototype.event(f).oneShot=!0;b=/^data\-(.*)/,d=["view","renderif","foreach","formfor","context","bind","source","target"],e={};for(i=k=0,m=d.length;k<m;i=++k)g=d[i],e[g]=i;return o.prototype._sortBindings=function(a,b){var c,f;return c=e[a[0]],f=e[b[0]],c==null&&(c=d.length),f==null&&(f=d.length),c>f?1:f>c?-1:a[0]>b[0]?1:b[0]>a[0]?-1:0},o.prototype.parseNode=function(a){var c,d,e,f,h,i,j,k,l,m,n,o,p,r,s,t,u,w,x,y=this;if(this.deferEvery&&new Date-this.startTime>this.deferEvery){this.resumeNode=a,this.timeout=v(this.resume);return}if(a.getAttribute&&a.attributes){e=[],t=a.attributes;for(o=0,r=t.length;o<r;o++){d=t[o],g=(u=d.nodeName.match(b))!=null?u[1]:void 0;if(!g)continue;e.push((h=g.split("-")).length>1?[h[0],h.slice(1,h.length+1||9e9).join("-"),d.value]:[g,void 0,d.value])}w=e.sort(this._sortBindings);for(p=0,s=w.length;p<s;p++){x=w[p],g=x[0],c=x[1],f=x[2],k=c?typeof (m=E.DOM.attrReaders)[g]=="function"?m[g](a,c,f,this.context,this):void 0:typeof (n=E.DOM.readers)[g]=="function"?n[g](a,f,this.context,this):void 0;if(k===!1){l=!0;break}k instanceof E.RenderContext&&(j=this.context,this.context=k,q(a,function(){return y.context=j}))}}return(i=this.nextNode(a,l))?this.parseNode(i):this.finish()},o.prototype.nextNode=function(a,b){var c,d,e,f;if(!b){c=a.childNodes;if(c!=null?c.length:void 0)return c[0]}f=a.nextSibling,q(a).forEach(function(a){return a()}),h(a);if(this.node===a)return;if(f)return f;d=a;while(d=d.parentNode){e=d.nextSibling,q(d).forEach(function(a){return a()}),h(d);if(this.node===d)return;if(e)return e}},o}(E.Object),E.RenderContext=function(){function b(a,b){this.object=a,this.parent=b}var a;return b.name="RenderContext",b.deProxy=function(a){return a!=null&&a.isContextProxy?a.get("proxiedObject"):a},b.root=function(){return E.currentApp!=null?E.currentApp.get("_renderContext"):this.base},b.prototype.windowWrapper=typeof window!="undefined"&&window!==null?{window:window}:{},b.prototype.findKey=function(a){var b,c,d;b=a.split(".")[0].split("|")[0].trim(),c=this;while(c){d=j(c.object,b);if(typeof d!="undefined")return d=j(c.object,a),[d,c.object].map(this.constructor.deProxy);c=c.parent}return[j(this.windowWrapper,a),this.windowWrapper]},b.prototype.get=function(a){return this.findKey(a)[0]},b.prototype.contextForKey=function(a){return this.findKey(a)[1]},b.prototype.descend=function(a,b){var c;return b&&(c=a,a=new E.Object,a[b]=c),new this.constructor(a,this)},b.prototype.descendWithKey=function(b,c){var d;return d=new a(this,b),this.descend(d,c)},b.prototype.chain=function(){var a,b;b=[],a=this;while(a)b.push(a.object),a=a.parent;return b},b.ContextProxy=a=function(a){function b(a,b,c){this.renderContext=a,this.keyPath=b,this.localKey=c,this.binding=new E.DOM.AbstractBinding(void 0,this.keyPath,this.renderContext)}return W(b,a),b.name="ContextProxy",b.prototype.isContextProxy=!0,b.accessor("proxiedObject",function(){return this.binding.get("filteredValue")}),b.accessor({get:function(a){return this.get("proxiedObject."+a)},set:function(a,b){return this.set("proxiedObject."+a,b)},unset:function(a){return this.unset("proxiedObject."+a)}}),b}(E.Object),b}.call(this),E.RenderContext.base=new E.RenderContext({window:E.container}),E.DOM={readers:{target:function(a,b,c,d){return E.DOM.readers.bind(a,b,c,d,"nodeChange"),!0},source:function(a,b,c,d){return E.DOM.readers.bind(a,b,c,d,"dataChange"),!0},bind:function(a,b,c,d,e){var f;f=!1;switch(a.nodeName.toLowerCase()){case"input":switch(a.getAttribute("type")){case"checkbox":return E.DOM.attrReaders.bind(a,"checked",b,c,d,e),!0;case"radio":f=E.DOM.RadioBinding;break;case"file":f=E.DOM.FileBinding}break;case"select":f=E.DOM.SelectBinding}return f||(f=E.DOM.Binding),function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b),f=typeof e;return f=="object"||f=="function"?e||d:d}(f,arguments,function(){}),!0},context:function(a,b,c,d){return c.descendWithKey(b)},mixin:function(a,b,c,d){return new E.DOM.MixinBinding(a,b,c.descend(E.mixins),d),!0},showif:function(a,b,c,d,e){return new E.DOM.ShowHideBinding(a,b,c,d,!1,e),!0},hideif:function(){var a;return(a=E.DOM.readers).showif.apply(a,T.call(arguments).concat([!0]))},route:function(){return function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b),f=typeof e;return f=="object"||f=="function"?e||d:d}(E.DOM.RouteBinding,arguments,function(){}),!0},view:function(){return function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b),f=typeof e;return f=="object"||f=="function"?e||d:d}(E.DOM.ViewBinding,arguments,function(){}),!1},partial:function(a,b,c,d){return E.DOM.partial(a,b,c,d),!0},defineview:function(a,b,c,d){return q(a,function(){return u(a)}),E.View.store.set(E.Navigator.normalizePath(b),a.innerHTML),!1},renderif:function(a,b,c,d){return new E.DOM.DeferredRenderingBinding(a,b,c,d),!1},yield:function(a,b){return q(a,function(){return E.DOM.createYieldContainer(b,a)}),!0},contentfor:function(a,b){return q(a,function(){return E.DOM.fillYieldContainer(b,a)}),!0},replace:function(a,b){return q(a,function(){return E.DOM.fillYieldContainer(b,a,!0)}),!0}},attrReaders:{_parseAttribute:function(a){return a==="false"&&(a=!1),a==="true"&&(a=!0),a},source:function(a,b,c,d,e){return E.DOM.attrReaders.bind(a,b,c,d,e,"dataChange")},bind:function(a,b,c,d,e,f){var g;return g=function(){switch(b){case"checked":case"disabled":case"selected":return E.DOM.CheckedBinding;case"value":case"href":case"src":case"size":return E.DOM.NodeAttributeBinding;case"class":return E.DOM.ClassBinding;case"style":return E.DOM.StyleBinding;default:return E.DOM.AttributeBinding}}(),function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b),f=typeof e;return f=="object"||f=="function"?e||d:d}(g,arguments,function(){}),!0},context:function(a,b,c,d){return d.descendWithKey(c,b)},event:function(a,b,c,d){return function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b),f=typeof e;return f=="object"||f=="function"?e||d:d}(E.DOM.EventBinding,arguments,function(){}),!0},addclass:function(a,b,c,d,e,f){return new E.DOM.AddClassBinding(a,b,c,d,e,!1,f),!0},removeclass:function(a,b,c,d,e){return E.DOM.attrReaders.addclass(a,b,c,d,e,!0)},foreach:function(a,b,c,d,e){return function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b),f=typeof e;return f=="object"||f=="function"?e||d:d}(E.DOM.IteratorBinding,arguments,function(){}),!1},formfor:function(a,b,c,d){return function(a,b,c){c.prototype=a.prototype;var d=new c,e=a.apply(d,b),f=typeof e;return f=="object"||f=="function"?e||d:d}(E.DOM.FormBinding,arguments,function(){}),d.descendWithKey(c,b)},view:function(a,b,c,d){var e,f;return e=d.contextForKey(c),f=null,e.observeAndFire(c,function(c){return f||(f=E.data(a,"view")),f!=null?f.set(b,c):void 0})}},events:{click:function(b,c,d,e){return e==null&&(e="click"),a(b,e,function(){var a;return a=1<=arguments.length?T.call(arguments,0):[],c.apply(null,[b].concat(T.call(a),[d])),r(a[0])}),b.nodeName.toUpperCase()==="A"&&!b.href&&(b.href="#"),b},doubleclick:function(a,b,c){return E.DOM.events.click(a,b,c,"dblclick")},change:function(b,c,d){var e,f,g,h,i,j;f=function(){var a;switch(b.nodeName.toUpperCase()){case"TEXTAREA":return["keyup","change"];case"INPUT":return(a=b.type.toLowerCase(),V.call(E.DOM.textInputTypes,a)>=0)?(g=c,c=function(a){var b;if(a.type==="keyup"&&13<=(b=a.keyCode)&&b<=14)return;return g.apply(null,arguments)},["keyup","change"]):["change"];default:return["change"]}}(),j=[];for(h=0,i=f.length;h<i;h++)e=f[h],j.push(a(b,e,function(){var a;return a=1<=arguments.length?T.call(arguments,0):[],c.apply(null,[b].concat(T.call(a),[d]))}));return j},isEnter:function(a){return a.keyCode===13||a.which===13||a.keyIdentifier==="Enter"||a.key==="Enter"},submit:function(b,c,d){return E.DOM.nodeIsEditable(b)?(a(b,"keydown",function(){var a;a=1<=arguments.length?T.call(arguments,0):[];if(E.DOM.events.isEnter(a[0]))return E.DOM._keyCapturingNode=b}),a(b,"keyup",function(){var a;a=1<=arguments.length?T.call(arguments,0):[];if(E.DOM.events.isEnter(a[0]))return E.DOM._keyCapturingNode===b&&(r(a[0]),c.apply(null,[b].concat(T.call(a),[d]))),E.DOM._keyCapturingNode=null})):a(b,"submit",function(){var a;return a=1<=arguments.length?T.call(arguments,0):[],r(a[0]),c.apply(null,[b].concat(T.call(a),[d]))}),b},other:function(b,c,d,e){return a(b,c,function(){var a;return a=1<=arguments.length?T.call(arguments,0):[],d.apply(null,[b].concat(T.call(a),[e]))})}},textInputTypes:["text","search","tel","url","email","password"],_yieldExecutors:{},_yieldContainers:{},createYieldContainer:function(a,b){return E.DOM._yieldContainers[a]=b,E.DOM._executeYield(a),!0},fillYieldContainer:function(a,c,d,e){var f,g,h;return(h=c.parentNode)!=null&&h.removeChild(c),f=function(f){var g;(d||!E._data(f,"yielded"))&&w(f,"",!0);if(e)while(c.childNodes.length>0)g=c.childNodes[0],b(f,g,!0);else b(f,c,!0);return E._data(c,"yielded",!0),E._data(f,"yielded",!0),delete E.DOM._yieldExecutors[a]},(g=E.DOM._yieldExecutors)[a]||(g[a]=[]),E.DOM._yieldExecutors[a].push(f),E.DOM._executeYield(a),!0},_executeYield:function(a){var b,c,d,e,f;c=E.DOM._yieldContainers[a];if(c==null)return;if(d=E.DOM._yieldExecutors[a])for(e=0,f=d.length;e<f;e++)b=d[e],b(c);return!0},partial:function(a,c,d,e){var f;return e.prevent("rendered"),f=new E.View({source:c,context:d}),f.on("ready",function(){var c,d,g,h,i;w(a,""),d=function(){var a,b,c,d;c=f.get("node").childNodes,d=[];for(a=0,b=c.length;a<b;a++)g=c[a],d.push(g);return d}();for(h=0,i=d.length;h<i;h++)c=d[h],b(a,c);return e.allowAndFire("rendered")})},trackBinding:z=function(a,b){var c;return(c=E._data(b,"bindings"))?c.push(a):E._data(b,"bindings",[a]),E.DOM.fire("bindingAdded",a),!0},unbindNode:B=function(a){var b,c,d,e;(b=E._data(a,"bindings"))&&b.forEach(function(a){return a.die()});if(e=E._data(a,"listeners"))for(d in e)c=e[d],c.forEach(function(b){return t(a,d,b)});return E.removeData(a),E.removeData(a,void 0,!0)},unbindTree:C=function(a,b){var c,d,e,f,g;b==null&&(b=!0),b&&B(a),f=a.childNodes,g=[];for(d=0,e=f.length;d<e;d++)c=f[d],g.push(C(c));return g},setInnerHTML:w=function(){var a,b,c,d,e,f,g,h;e=arguments[0],d=arguments[1],a=3<=arguments.length?T.call(arguments,2):[],h=e.childNodes;for(f=0,g=h.length;f<g;f++)b=h[f],(c=E.data(b,"hide"))&&c.apply(b,a);return C(e,!1),e!=null?e.innerHTML=d:void 0},setStyleProperty:x=function(a,b,c,d){return a.style.setAttribute?a.style.setAttribute(b,c,d):a.style.setProperty(b,c,d)},removeNode:u=function(a){var b;return(b=a.parentNode)!=null&&b.removeChild(a),E.DOM.didRemoveNode(a)},appendChild:b=function(){var a,b,c,d,e;return c=arguments[0],b=arguments[1],a=3<=arguments.length?T.call(arguments,2):[],d=E.data(b,"view"),d!=null&&d.fire("beforeAppear",b),(e=E.data(b,"show"))!=null&&e.apply(b,a),c.appendChild(b),d!=null?d.fire("appear",b):void 0},insertBefore:m=function(a,c,d){return d==null&&(d=null),!d||a.childNodes.length<=0?b(a,c):a.insertBefore(c,d)},valueForNode:function(a,b,c){var d;b==null&&(b=""),c==null&&(c=!0),d=arguments.length>1;switch(a.nodeName.toUpperCase()){case"INPUT":case"TEXTAREA":return d?a.value=b:a.value;case"SELECT":if(d)return a.value=b;break;default:return d?w(a,c?e(b):b):a.innerHTML}},nodeIsEditable:function(a){var b;return(b=a.nodeName.toUpperCase())==="INPUT"||b==="TEXTAREA"||b==="SELECT"},addEventListener:a=function(a,b,c){var d;return(d=E._data(a,"listeners"))||(d=E._data(a,"listeners",{})),d[b]||(d[b]=[]),d[b].push(c),l?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},removeEventListener:t=function(a,b,c){var d,e,f;if(f=E._data(a,"listeners"))if(d=f[b])e=d.indexOf(c),e!==-1&&d.splice(e,1);return l?a.removeEventListener(b,c,!1):a.detachEvent("on"+b,c)},hasAddEventListener:l=typeof window!="undefined"&&window!==null?!!window.addEventListener:!!void 0,preventDefault:r=function(a){return typeof a.preventDefault=="function"?a.preventDefault():a.returnValue=!1},stopPropagation:y=function(a){return a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},didRemoveNode:function(a){var b;return b=E.data(a,"view"),b!=null&&b.fire("beforeDisappear",a),C(a),b!=null?b.fire("disappear",a):void 0},onParseExit:q=function(a,b){var c;return c=E._data(a,"onParseExit")||E._data(a,"onParseExit",[]),b!=null&&c.push(b),c},forgetParseExit:h=function(a,b){return E.removeData(a,"onParseExit",!0)}},o(E.DOM,E.EventEmitter,E.Observable),E.DOM.event("bindingAdded"),E.DOM.AbstractBinding=function(a){function e(a,b,c,d,e){this.node=a,this.keyPath=b,this.renderContext=c,this.renderer=d,this.only=e!=null?e:!1,this._fireDataChange=X(this._fireDataChange,this),this._fireNodeChange=X(this._fireNodeChange,this),this.parseFilter(),this.bindImmediately&&this.bind()}var b,c,d;return W(e,a),e.name="AbstractBinding",d=/(^|,)\s*(?!(?:true|false)\s*(?:$|,))([a-zA-Z][\w-\.]*[\?\!]?)\s*(?=$|,)/g,b=/(?:\]\.)(.+?)(?=[\[\.]|\s*\||$)/,c=/(?!^\s*)\[(.*?)\]/g,e.accessor("filteredValue",{get:function(){var a,b,c,d;return d=this.get("unfilteredValue"),c=this,a=this.get("renderContext"),this.filterFunctions.length>0?(K.currentFilterStack=a,b=this.filterFunctions.reduce(function(b,d,e){var f;return f=c.filterArguments[e].map(function(a){return a._keypath?c.renderContext.get(a._keypath):a}),f.unshift(b),f.push(c),d.apply(a,f)},d),K.currentFilterStack=null,b):d},set:function(a,b){return this.set("unfilteredValue",b)}}),e.accessor("unfilteredValue",{get:function(){var a;return(a=this.get("key"))?E.RenderContext.deProxy(k(this,["keyContext",a])):this.get("value")},set:function(a,b){var c,d,e;if(!(c=this.get("key")))return this.set("value",b);d=this.get("keyContext");if(d&&d!==E.container)return e=E.Property.forBaseAndKey(d,c),e.setValue(b)}}),e.accessor("keyContext",function(){return this.renderContext.contextForKey(this.key)}),e.prototype.bindImmediately=!0,e.prototype.shouldSet=!0,e.prototype.isInputBinding=!1,e.prototype.escapeValue=!0,e.prototype.isTwoWay=function(){return this.key!=null&&this.filterFunctions.length===0},e.prototype.bind=function(){var a,b;this.node!=null&&((a=this.only)===!1||a==="nodeChange")&&E.DOM.nodeIsEditable(this.node)&&(E.DOM.events.change(this.node,this._fireNodeChange,this.renderContext),this.only==="nodeChange"&&this._fireNodeChange()),((b=this.only)===!1||b==="dataChange")&&this.observeAndFire("filteredValue",this._fireDataChange);if(this.node!=null)return E.DOM.trackBinding(this,this.node)},e.prototype._fireNodeChange=function(){return this.shouldSet=!1,typeof this.nodeChange=="function"&&this.nodeChange(this.node,this.value||this.get("keyContext")),this.shouldSet=!0},e.prototype._fireDataChange=function(a){if(this.shouldSet)return typeof this.dataChange=="function"?this.dataChange(a,this.node):void 0},e.prototype.die=function(){var a;return this.forget(),(a=this._batman.properties)!=null?a.forEach(function(a,b){return b.die()}):void 0},e.prototype.parseFilter=function(){var a,d,e,f,g,h,i,j,k;this.filterFunctions=[],this.filterArguments=[],i=this.keyPath;while(b.test(i))i=i.replace(b,"]['$1']");g=i.replace(c," | get $1 ").replace(/'/g,'"').split(/(?!")\s+\|\s+(?!")/);try{h=this.parseSegment(j=g.shift())[0]}catch(l){K.warn(l),K.error("Error! Couldn't parse keypath in \""+j+'". Parsing error above.')}h&&h._keypath?this.key=h._keypath:this.value=h;if(g.length){while(f=g.shift()){k=f.indexOf(" "),~k?(e=f.substr(0,k),a=f.substr(k)):e=f;if(d=E.Filters[e]){this.filterFunctions.push(d);if(a)try{this.filterArguments.push(this.parseSegment(a))}catch(l){K.error('Bad filter arguments "'+a+'"!')}else this.filterArguments.push([])}else K.error("Unrecognized filter '"+e+"' in key \""+this.keyPath+'"!')}return!0}},e.prototype.parseSegment=function(a){return JSON.parse("["+a.replace(d,'$1{"_keypath": "$2"}'
)+"]")},e}(E.Object),E.DOM.AbstractAttributeBinding=function(a){function b(){var a,c;c=arguments[0],attributeName=arguments[1],a=3<=arguments.length?T.call(arguments,2):[],this.attributeName=attributeName,b.__super__.constructor.apply(this,[c].concat(T.call(a)))}return W(b,a),b.name="AbstractAttributeBinding",b}(E.DOM.AbstractBinding),E.DOM.AbstractCollectionBinding=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="AbstractCollectionBinding",b.prototype.bindCollection=function(a){if(a!==this.collection){this.unbindCollection(),this.collection=a;if(this.collection){if(this.collection.isObservable&&this.collection.toArray)this.collection.observe("toArray",this.handleArrayChanged);else{if(!this.collection.isEventEmitter)return!1;this.collection.on("itemsWereAdded",this.handleItemsWereAdded),this.collection.on("itemsWereRemoved",this.handleItemsWereRemoved)}return!0}}return!1},b.prototype.unbindCollection=function(){if(this.collection){if(this.collection.isObservable&&this.collection.toArray)return this.collection.forget("toArray",this.handleArrayChanged);if(this.collection.isEventEmitter)return this.collection.event("itemsWereAdded").removeHandler(this.handleItemsWereAdded),this.collection.event("itemsWereRemoved").removeHandler(this.handleItemsWereRemoved)}},b.prototype.handleItemsWereAdded=function(){},b.prototype.handleItemsWereRemoved=function(){},b.prototype.handleArrayChanged=function(){},b.prototype.die=function(){return this.unbindCollection(),b.__super__.die.apply(this,arguments)},b}(E.DOM.AbstractAttributeBinding),E.DOM.Binding=function(a){function b(a){var c;this.isInputBinding=(c=a.nodeName.toLowerCase())==="input"||c==="textarea",b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="Binding",b.prototype.nodeChange=function(a,b){if(this.isTwoWay())return this.set("filteredValue",this.node.value)},b.prototype.dataChange=function(a,b){return E.DOM.valueForNode(this.node,a,this.escapeValue)},b}(E.DOM.AbstractBinding),E.DOM.AttributeBinding=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="AttributeBinding",b.prototype.dataChange=function(a){return this.node.setAttribute(this.attributeName,a)},b.prototype.nodeChange=function(a){if(this.isTwoWay())return this.set("filteredValue",E.DOM.attrReaders._parseAttribute(a.getAttribute(this.attributeName)))},b}(E.DOM.AbstractAttributeBinding),E.DOM.NodeAttributeBinding=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="NodeAttributeBinding",b.prototype.dataChange=function(a){return a==null&&(a=""),this.node[this.attributeName]=a},b.prototype.nodeChange=function(a){if(this.isTwoWay())return this.set("filteredValue",E.DOM.attrReaders._parseAttribute(a[this.attributeName]))},b}(E.DOM.AbstractAttributeBinding),E.DOM.ShowHideBinding=function(a){function b(a,c,d,e,f,g){var h;this.invert=g!=null?g:!1,h=a.style.display;if(!h||h==="none")h="";this.originalDisplay=h,b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="ShowHideBinding",b.prototype.dataChange=function(a){var b,c,d;return c=E.data(this.node,"view"),!!a==!this.invert?(c!=null&&c.fire("beforeAppear",this.node),(d=E.data(this.node,"show"))!=null&&d.call(this.node),this.node.style.display=this.originalDisplay,c!=null?c.fire("appear",this.node):void 0):(c!=null&&c.fire("beforeDisappear",this.node),typeof (b=E.data(this.node,"hide"))=="function"?b.call(this.node):x(this.node,"display","none","important"),c!=null?c.fire("disappear",this.node):void 0)},b}(E.DOM.AbstractBinding),E.DOM.CheckedBinding=function(a){function b(){b.__super__.constructor.apply(this,arguments),E._data(this.node,this.attributeName,this)}return W(b,a),b.name="CheckedBinding",b.prototype.isInputBinding=!0,b.prototype.dataChange=function(a){var b;this.node[this.attributeName]=!!a;if(this.node.parentNode)return typeof (b=E._data(this.node.parentNode,"updateBinding"))=="function"?b():void 0},b}(E.DOM.NodeAttributeBinding),E.DOM.ClassBinding=function(a){function b(){return this.handleItemsWereAdded=X(this.handleItemsWereAdded,this),this.handleItemsWereRemoved=X(this.handleItemsWereRemoved,this),this.handleArrayChanged=X(this.handleArrayChanged,this),b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="ClassBinding",b.prototype.dataChange=function(a){if(a!=null)return this.unbindCollection(),typeof a=="string"?this.node.className=a:(this.bindCollection(a),this.updateFromCollection())},b.prototype.updateFromCollection=function(){var a,b,c;if(this.collection)return a=this.collection.map?this.collection.map(function(a){return a}):function(){var a,d;a=this.collection,d=[];for(b in a){if(!U.call(a,b))continue;c=a[b],d.push(b)}return d}.call(this),a.toArray!=null&&(a=a.toArray()),this.node.className=a.join(" ")},b.prototype.handleArrayChanged=function(){return this.updateFromCollection()},b.prototype.handleItemsWereRemoved=function(){return this.updateFromCollection()},b.prototype.handleItemsWereAdded=function(){return this.updateFromCollection()},b}(E.DOM.AbstractCollectionBinding),E.DOM.DeferredRenderingBinding=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.node.removeAttribute("data-renderif")}return W(b,a),b.name="DeferredRenderingBinding",b.prototype.rendered=!1,b.prototype.nodeChange=function(){},b.prototype.dataChange=function(a){if(a&&!this.rendered)return this.render()},b.prototype.render=function(){return new E.Renderer(this.node,null,this.renderContext),this.rendered=!0},b}(E.DOM.AbstractBinding),E.DOM.AddClassBinding=function(a){function b(a,c,d,e,f,g,h){var i,j;this.invert=h!=null?h:!1,j=c.split("|"),this.classes=function(){var a,b,c;c=[];for(a=0,b=j.length;a<b;a++)i=j[a],c.push({name:i,pattern:new RegExp("(?:^|\\s)"+i+"(?:$|\\s)","i")});return c}(),b.__super__.constructor.apply(this,arguments),delete this.attributeName}return W(b,a),b.name="AddClassBinding",b.prototype.dataChange=function(a){var b,c,d,e,f,g,h,i;b=this.node.className,h=this.classes;for(f=0,g=h.length;f<g;f++)i=h[f],d=i.name,e=i.pattern,c=e.test(b),!!a==!this.invert?c||(this.node.className=""+b+" "+d):c&&(this.node.className=b.replace(e," "));return!0},b}(E.DOM.AbstractAttributeBinding),E.DOM.EventBinding=function(a){function b(a,c,d,e){var f,g,h,i=this;b.__super__.constructor.apply(this,arguments),h=this.node.getAttribute("data-confirm"),g=function(){var a;if(h&&!confirm(h))return;return(a=i.get("filteredValue"))!=null?a.apply(i.get("callbackContext"),arguments):void 0},(f=E.DOM.events[this.attributeName])?f(this.node,g,e):E.DOM.events.other(this.node,this.attributeName,g,e),this.bind()}return W(b,a),b.name="EventBinding",b.prototype.bindImmediately=!1,b.accessor("callbackContext",function(){var a;return a=this.key.split("."),a.pop(),a.length>0?this.get("keyContext").get(a.join(".")):this.get("keyContext")}),b}(E.DOM.AbstractAttributeBinding),E.DOM.RadioBinding=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="RadioBinding",b.prototype.isInputBinding=!0,b.prototype.dataChange=function(a){var b;if((b=this.get("filteredValue"))!=null)return this.node.checked=b===this.node.value;if(this.node.checked)return this.set("filteredValue",this.node.value)},b.prototype.nodeChange=function(a){if(this.isTwoWay())return this.set("filteredValue",E.DOM.attrReaders._parseAttribute(a.value))},b}(E.DOM.AbstractBinding),E.DOM.FileBinding=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="FileBinding",b.prototype.isInputBinding=!0,b.prototype.nodeChange=function(a,b){if(!this.isTwoWay())return;return a.hasAttribute("multiple")?this.set("filteredValue",Array.prototype.slice.call(a.files)):this.set("filteredValue",a.files[0])},b}(E.DOM.AbstractBinding),E.DOM.MixinBinding=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="MixinBinding",b.prototype.dataChange=function(a){if(a!=null)return o(this.node,a)},b}(E.DOM.AbstractBinding),E.DOM.SelectBinding=function(a){function b(){this.updateOptionBindings=X(this.updateOptionBindings,this),this.updateSelectBinding=X(this.updateSelectBinding,this),this.nodeChange=X(this.nodeChange,this),this.dataChange=X(this.dataChange,this);var a=this;b.__super__.constructor.apply(this,arguments),this.renderer.on("rendered",function(){if(a.node!=null)return E._data(a.node,"updateBinding",a.updateSelectBinding),a.bind()})}return W(b,a),b.name="SelectBinding",b.prototype.isInputBinding=!0,b.prototype.bindImmediately=!1,b.prototype.firstBind=!0,b.prototype.dataChange=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;if(a instanceof Array){f={},m=this.node.children;for(g=0,j=m.length;g<j;g++)b=m[g],b.selected=!1,d=f[b.value],d?d.push(b):d=[b],f[b.value]=d;for(h=0,k=a.length;h<k;h++){e=a[h],n=f[e];for(i=0,l=n.length;i<l;i++)c=n[i],c.selected=!0}}else typeof a=="undefined"&&this.firstBind?(this.firstBind=!1,this.set("unfilteredValue",this.node.value)):E.DOM.valueForNode(this.node,a,this.escapeValue);return this.updateOptionBindings()},b.prototype.nodeChange=function(){if(this.isTwoWay())return this.updateSelectBinding(),this.updateOptionBindings()},b.prototype.updateSelectBinding=function(){var a,b;return b=this.node.multiple?function(){var b,c,d,e;d=this.node.children,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],a.selected&&e.push(a.value);return e}.call(this):this.node.value,typeof b===Array&&b.length===1&&(b=b[0]),this.set("unfilteredValue",b),!0},b.prototype.updateOptionBindings=function(){var a,b,c,d,e;e=this.node.children;for(c=0,d=e.length;c<d;c++)a=e[c],(b=E._data(a,"selected"))&&b.nodeChange(b.node);return!0},b}(E.DOM.AbstractBinding),E.DOM.StyleBinding=function(a){function b(){this.setStyle=X(this.setStyle,this),this.handleItemsWereRemoved=X(this.handleItemsWereRemoved,this),this.handleItemsWereAdded=X(this.handleItemsWereAdded,this),this.oldStyles={},b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="StyleBinding",b.SingleStyleBinding=function(a){function b(){var a,c;a=2<=arguments.length?T.call(arguments,0,c=arguments.length-1):(c=0,[]),parent=arguments[c++],this.parent=parent,b.__super__.constructor.apply(this,a)}return W(b,a),b.name="SingleStyleBinding",b.prototype.dataChange=function(a){return this.parent.setStyle(this.attributeName,a)},b}(E.DOM.AbstractAttributeBinding),b.prototype.dataChange=function(a){var b,c,d,e,f,g,h,i,j,k,l,m=this;if(!a){this.reapplyOldStyles();return}this.unbindCollection();if(typeof a=="string"){this.reapplyOldStyles(),j=a.split(";");for(h=0,i=j.length;h<i;h++)g=j[h],k=g.split(":"),c=k[0],b=2<=k.length?T.call(k,1):[],this.setStyle(c,b.join(":"));return}if(a instanceof E.Hash){if(this.bindCollection(a))return a.forEach(function(a,b){return m.setStyle(a,b)})}else if(a instanceof Object){this.reapplyOldStyles(),l=[];for(d in a){if(!U.call(a,d))continue;e=a[d],(f=this.renderContext.get(e))?(this.bindSingleAttribute(d,e),l.push(this.setStyle(d,f))):l.push(this.setStyle(d,e))}return l}},b.prototype.handleItemsWereAdded=function(a){this.setStyle(a,this.collection.get(a))},b.prototype.handleItemsWereRemoved=function(a){this.setStyle(a,"")},b.prototype.bindSingleAttribute=function(a,b){return new this.constructor.SingleStyleBinding(this.node,a,b,this.renderContext,this.renderer,this.only,this)},b.prototype.setStyle=function(a,b){if(!a)return;return a=L.camelize(a.trim(),!0),this.oldStyles[a]=this.node.style[a],this.node.style[a]=b?b.trim():""},b.prototype.reapplyOldStyles=function(){var a,b,c,d;c=this.oldStyles,d=[];for(a in c){if(!U.call(c,a))continue;b=c[a],d.push(this.setStyle(a,b))}return d},b}(E.DOM.AbstractCollectionBinding),E.DOM.RouteBinding=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="RouteBinding",b.prototype.onATag=!1,b.accessor("dispatcher",function(){return this.renderContext.get("dispatcher")||E.App.get("current.dispatcher")}),b.prototype.bind=function(){var a=this;return this.node.nodeName.toUpperCase()==="A"&&(this.onATag=!0),b.__super__.bind.apply(this,arguments),E.DOM.events.click(this.node,function(b,c){var d;E.DOM.stopPropagation(c),d=a.pathFromValue(a.get("filteredValue"));if(d!=null)return E.redirect(d)})},b.prototype.dataChange=function(a){var b;a!=null&&(b=this.pathFromValue(a));if(this.onATag)return b!=null?b=E.navigator.linkTo(b):b="#",this.node.href=b},b.prototype.pathFromValue=function(a){var b;return a.isNamedRouteQuery?a.get("path"):(b=this.get("dispatcher"))!=null?b.pathFromParams(a):void 0},b}(E.DOM.AbstractBinding),E.DOM.ViewBinding=function(a){function b(){b.__super__.constructor.apply(this,arguments),this.renderer.prevent("rendered"),this.node.removeAttribute("data-view")}return W(b,a),b.name="ViewBinding",b.prototype.dataChange=function(a){var b=this;if(a==null)return;return a.isView?(this.view=a,this.view.set("context",this.renderContext),this.view.set("node",this.node)):this.view=new a({node:this.node,context:this.renderContext,parentView:this.renderer.view}),E.data(this.node,"view",this.view),this.view.on("ready",function(){var a;return typeof (a=b.view).awakeFromHTML=="function"&&a.awakeFromHTML(b.node),b.view.fire("beforeAppear",b.node),b.renderer.allowAndFire("rendered"),b.view.fire("appear",b.node)}),this.die()},b}(E.DOM.AbstractBinding),E.DOM.FormBinding=function(a){function b(a,c,d,e,f,g){this.bindingWasAdded=X(this.bindingWasAdded,this),b.__super__.constructor.apply(this,arguments),this.contextName=c,delete this.attributeName,E.DOM.events.submit(this.get("node"),function(a,b){return r(b)}),E.DOM.on("bindingAdded",this.bindingWasAdded),this.setupErrorsList()}return W(b,a),b.name="FormBinding",b.current=null,b.prototype.errorClass="error",b.prototype.defaultErrorsListSelector="div.errors",b.accessor("errorsListSelector",function(){return this.get("node").getAttribute("data-errors-list")||this.defaultErrorsListSelector}),b.prototype.bindingWasAdded=function(a){var b,c,d;if(a.isInputBinding&&n(this.get("node"),a.get("node"))&&~(c=a.get("key").indexOf(this.contextName)))return d=a.get("node"),b=a.get("key").slice(c+this.contextName.length+1),new E.DOM.AddClassBinding(d,this.errorClass,this.get("keyPath")+(" | get 'errors."+b+".length'"),this.renderContext,this.renderer)},b.prototype.setupErrorsList=function(){var a;if(this.errorsListNode=typeof (a=this.get("node")).querySelector=="function"?a.querySelector(this.get("errorsListSelector")):void 0){w(this.errorsListNode,this.errorsListHTML());if(!this.errorsListNode.getAttribute("data-showif"))return this.errorsListNode.setAttribute("data-showif",""+this.contextName+".errors.length")}},b.prototype.errorsListHTML=function(){return'<ul>\n  <li data-foreach-error="'+this.contextName+'.errors" data-bind="error.attribute | append \' \' | append error.message"></li>\n</ul>'},b.prototype.die=function(){return E.DOM.forget("bindingAdded",this.bindingWasAdded),b.__super__.die.apply(this,arguments)},b}(E.DOM.AbstractAttributeBinding),E.DOM.IteratorBinding=function(a){function b(a,c,d,e,f){var g,h=this;this.iteratorName=c,this.key=d,this.context=e,this.parentRenderer=f,this.handleArrayChanged=X(this.handleArrayChanged,this),this.handleItemsWereRemoved=X(this.handleItemsWereRemoved,this),this.handleItemsWereAdded=X(this.handleItemsWereAdded,this),this.nodeMap=new E.SimpleHash,this.actionMap=new E.SimpleHash,this.rendererMap=new E.SimpleHash,this.actions=[],this.prototypeNode=a.cloneNode(!0),this.prototypeNode.removeAttribute("data-foreach-"+this.iteratorName),this.pNode=a.parentNode,g=a.nextSibling,this.siblingNode=document.createComment("end "+this.iteratorName),this.siblingNode[E.expando]=a[E.expando],E.canDeleteExpando&&delete a[E.expando],m(a.parentNode,this.siblingNode,g),this.parentRenderer.on("parsed",function(){return u(a),h.bind()}),this.parentRenderer.prevent("rendered"),b.__super__.constructor.call(this,this.siblingNode,this.iteratorName,this.key,this.context,this.parentRenderer),this.fragment=document.createDocumentFragment()}return W(b,a),b.name="IteratorBinding",b.prototype.deferEvery=50,b.prototype.currentActionNumber=0,b.prototype.queuedActionNumber=0,b.prototype.bindImmediately=!1,b.prototype.parentNode=function(){return this.siblingNode.parentNode},b.prototype.die=function(){return b.__super__.die.apply(this,arguments),this.dead=!0},b.prototype.unbindCollection=function(){var a=this;if(this.collection)return this.nodeMap.forEach(function(b){return a.cancelExistingItem(b)}),b.__super__.unbindCollection.apply(this,arguments)},b.prototype.dataChange=function(a){var b,c,d,e=this;this.collection!==a&&this.removeAll(),this.bindCollection(a);if(this.collection)if(this.collection.toArray)this.handleArrayChanged();else if(this.collection.forEach)this.collection.forEach(function(a){return e.addOrInsertItem(a)});else{d=this.collection;for(b in d){if(!U.call(d,b))continue;c=d[b],this.addOrInsertItem(b)}}else K.warn("Warning! data-foreach-"+this.iteratorName+" called with an undefined binding. Key was: "+this.key+".");return this.processActionQueue()},b.prototype.handleItemsWereAdded=function(){var a,b,c,d;b=1<=arguments.length?T.call(arguments,0):[];for(c=0,d=b.length;c<d;c++)a=b[c],this.addOrInsertItem(a,{fragment:!1})},b.prototype.handleItemsWereRemoved=function(){var a,b,c,d;b=1<=arguments.length?T.call(arguments,0):[];for(c=0,d=b.length;c<d;c++)a=b[c],this.removeItem(a)},b.prototype.handleArrayChanged=function(){var a,b,c,d,e,f=this;b=this.collection.toArray(),c=(new E.SimpleHash).merge(this.nodeMap);for(d=0,e=b.length;d<e;d++)a=b[d],this.addOrInsertItem(a,{fragment:!1}),c.unset(a);return c.forEach(function(a,b){return f.removeItem(a)})},b.prototype.addOrInsertItem=function(a,b){var c;return b==null&&(b={}),c=this.nodeMap.get(a),c?this.insertItem(a,c):this.addItem(a,b)},b.prototype.addItem=function(a,b){var c,d,e,f=this;return b==null&&(b={fragment:!0}),this.parentRenderer.prevent("rendered"),this.actionMap.get(a)!=null&&this.cancelExistingItemActions(a),e=this,b.actionNumber=this.queuedActionNumber++,c=new E.Renderer(this._nodeForItem(a),function(){return e.rendererMap.unset(a),e.insertItem(a,this.node,b)},this.renderContext.descend(a,this.iteratorName)),this.rendererMap.set(a,c),d=function(){if(f.dead)return;return f.parentRenderer.allowAndFire("rendered")},c.on("rendered",d),c.on("stopped",function(){if(f.dead)return;return f.actions[b.actionNumber]=!1,d(),f.processActionQueue()}),a},b.prototype.removeItem=function(a){var b,c;if(this.dead||a==null)return;c=this.nodeMap.unset(a),this.cancelExistingItem(a);if(c)return(b=E.data(c,"hide"))?b.call(c):u(c)},b.prototype.removeAll=function(){var a=this;return this.nodeMap.forEach(function(b){return a.removeItem(b)})},b.prototype.insertItem=function(a,b,c){var d;c==null&&(c={});if(this.dead)return;return c.actionNumber==null&&(c.actionNumber=this.queuedActionNumber++),d=this.actionMap.get(a),d>c.actionNumber?this.actions[c.actionNumber]=function(){}:(d&&this.cancelExistingItemActions(a),this.actionMap.set(a,c.actionNumber),this.actions[c.actionNumber]=function(){var d,e,f;e=E.data(b,"show"),typeof e=="function"?e.call(b,{before:this.siblingNode}):c.fragment?this.fragment.appendChild(b):m(this.parentNode(),b,this.siblingNode);if(d=b.getAttribute("data-additem"))return(f=this.renderer.context.contextForKey(d))!=null?typeof f[d]=="function"?f[d](a,b):void 0:void 0},this.actions[c.actionNumber].item=a),this.processActionQueue()},b.prototype.cancelExistingItem=function(a){return this.cancelExistingItemActions(a),this.cancelExistingItemRender(a)},b.prototype.cancelExistingItemActions=function(a){var b;return b=this.actionMap.get(a),b!=null&&b>=this.currentActionNumber&&(this.actions[b]=!1),this.actionMap.unset(a)},b.prototype.cancelExistingItemRender=function(a){var b;return b=this.rendererMap.get(a),b&&(b.stop(),u(b.node)),this.rendererMap.unset(a)},b.prototype.processActionQueue=function(){var a=this;if(this.dead)return;if(!this.actionQueueTimeout)return this.actionQueueTimeout=v(function(){var b,c;if(a.dead)return;delete a.actionQueueTimeout,c=new Date;while((b=a.actions[a.currentActionNumber])!=null){delete a.actions[a.currentActionNumber],a.actionMap.unset(b.item),b&&b.call(a),a.currentActionNumber++;if(a.deferEvery&&new Date-c>a.deferEvery)return a.processActionQueue()}a.fragment&&a.rendererMap.length===0&&a.fragment.hasChildNodes()&&(m(a.parentNode(),a.fragment,a.siblingNode),a.fragment=document.createDocumentFragment());if(a.currentActionNumber===a.queuedActionNumber)return a.parentRenderer.allowAndFire("rendered")})},b.prototype._nodeForItem=function(a){var b;return b=this.prototypeNode.cloneNode(!0),this.nodeMap.set(a,b),b},b}(E.DOM.AbstractCollectionBinding),H=function(a){return function(b){if(typeof b=="undefined")return;return a.apply(this,arguments)}},E.Filters={raw:H(function(a,b){return b.escapeValue=!1,a}),get:H(function(a,b){return a.get!=null?a.get(b):a[b]}),equals:H(function(a,b,c){return a===b}),not:function(a,b){return!a},matches:H(function(a,b){return a.indexOf(b)!==-1}),truncate:H(function(a,b,c,d){return c==null&&(c="..."),d||(d=c,c="..."),a.length>b&&(a=a.substr(0,b-c.length)+c),a}),"default":function(a,b,c){return a||b},prepend:function(a,b,c){return b+a},append:function(a,b,c){return a+b},replace:H(function(a,b,c,d,e){return e||(e=d,d=void 0),d===void 0?a.replace(b,c):a.replace(b,c,d)}),downcase:H(function(a){return a.toLowerCase()}),upcase:H(function(a){return a.toUpperCase()}),pluralize:H(function(a,b){return L.pluralize(b,a)}),join:H(function(a,b,c){return b==null&&(b=""),c||(c=b,b=""),a.join(b)}),sort:H(function(a){return a.sort()}),map:H(function(a,b){return a.map(function(a){return j(a,b)})}),has:function(a,b){return a==null?!1:E.contains(a,b)},first:H(function(a){return a[0]}),meta:H(function(a,b){return K.assert(a.meta,"Error, value doesn't have a meta to filter on!"),a.meta.get(b)}),interpolate:function(a,b,c){var d,e,f;c||(c=b,b=void 0);if(!a)return;f={};for(d in b)e=b[d],f[d]=this.get(e),f[d]==null&&(E.developer.warn("Warning! Undefined interpolation key "+d+" for interpolation",a),f[d]="");return E.helpers.interpolate(a,f)},withArguments:function(){var a,b,c,d;b=arguments[0],c=3<=arguments.length?T.call(arguments,1,d=arguments.length-1):(d=1,[]),a=arguments[d++];if(!b)return;return function(){var a;return a=1<=arguments.length?T.call(arguments,0):[],b.call.apply(b,[this].concat(T.call(c),T.call(a)))}},routeToAction:H(function(a,b){var c;return c=E.Dispatcher.paramsFromArgument(a),c.action=b,c}),escape:H(e)},function(){var a,b,c,d,e;d=["capitalize","singularize","underscore","camelize"],e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(E.Filters[a]=H(L[a]));return e}(),K.addFilters(),function(){var a;return a=function(a){var b;for(b in a)return!1;return!0},o(E,{cache:{},uuid:0,expando:"batman"+Math.random().toString().replace(/\D/g,""),canDeleteExpando:function(){var a;try{return a=document.createElement("div"),delete a.test}catch(b){return E.canDeleteExpando=!1}}(),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(b){return b=b.nodeType?E.cache[b[E.expando]]:b[E.expando],!!b&&!a(b)},data:function(a,b,c,d){var e,f,g,h,i,j;if(!E.acceptData(a))return;h=E.expando,f=typeof b=="string",e=E.cache,g=a[E.expando];if((!g||d&&g&&e[g]&&!e[g][h])&&f&&c===void 0)return;g||(a.nodeType!==3?a[E.expando]=g=++E.uuid:g=E.expando),e[g]||(e[g]={});if(typeof b=="object"||typeof b=="function")d?e[g][h]=o(e[g][h],b):e[g]=o(e[g],b);return j=e[g],d&&(j[h]||(j[h]={}),j=j[h]),c!==void 0&&(j[b]=c),f?i=j[b]:i=j,i},removeData:function(b,c,d){var e,f,g,h,i,j;if(!E.acceptData(b))return;h=E.expando,i=b.nodeType,e=E.cache,f=b[E.expando];if(!e[f])return;if(c){j=d?e[f][h]:e[f];if(j){delete j[c];if(!a(j))return}}if(d){delete e[f][h];if(!a(e[f]))return}return g=e[f][h],E.canDeleteExpando||!e.setInterval?delete e[f]:e[f]=null,g?(e[f]={},e[f][h]=g):E.canDeleteExpando?delete b[E.expando]:b.removeAttribute?b.removeAttribute(E.expando):b[E.expando]=null},_data:function(a,b,c){return E.data(a,b,c,!0)},acceptData:function(a){var b;if(a.nodeName){b=E.noData[a.nodeName.toLowerCase()];if(b)return b!==!0&&a.getAttribute("classid")===b}return!0}})}(),E.mixins=new E.Object,E.Encoders={},E.Paginator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="Paginator",b.Range=function(){function a(a,b){this.offset=a,this.limit=b,this.reach=a+b}return a.name="Range",a.prototype.coversOffsetAndLimit=function(a,b){return a>=this.offset&&a+b<=this.reach},a}(),b.Cache=function(a){function b(a,c,d){this.offset=a,this.limit=c,this.items=d,b.__super__.constructor.apply(this,arguments),this.length=d.length}return W(b,a),b.name="Cache",b.prototype.itemsForOffsetAndLimit=function(a,b){var c,d,e,f;return c=a-this.offset,d=c+b,c<0&&(e=new Array(-c),c=0),f=this.items.slice(c,d),e?e.concat(f):f},b}(b.Range),b.prototype.offset=0,b.prototype.limit=10,b.prototype.totalCount=0,b.prototype.markAsLoadingOffsetAndLimit=function(a,b){return this.loadingRange=new E.Paginator.Range(a,b)},b.prototype.markAsFinishedLoading=function(){return delete this.loadingRange},b.prototype.offsetFromPageAndLimit=function(a,b){return Math.round((+a-1)*b)},b.prototype.pageFromOffsetAndLimit=function(a,b){return a/b+1},b.prototype._load=function(a,b){var c;if((c=this.loadingRange)!=null?c.coversOffsetAndLimit(a,b):void 0)return;return this.markAsLoadingOffsetAndLimit(a,b),this.loadItemsForOffsetAndLimit(a,b)},b.prototype.toArray=function(){var a,b,c;return a=this.get("cache"),c=this.get("offset"),b=this.get("limit"),(a!=null?!a.coversOffsetAndLimit(c,b):!void 0)&&this._load(c,b),(a!=null?a.itemsForOffsetAndLimit(c,b):void 0)||[]},b.prototype.page=function(){return this.pageFromOffsetAndLimit(this.get("offset"),this.get("limit"))},b.prototype.pageCount=function(){return Math.ceil(this.get("totalCount")/this.get("limit"))},b.prototype.previousPage=function(){return this.set("page",this.get("page")-1)},b.prototype.nextPage=function(){return this.set("page",this.get("page")+1)},b.prototype.loadItemsForOffsetAndLimit=function(a,b){},b.prototype.updateCache=function(a,b,c){var d;d=new E.Paginator.Cache(a,b,c);if(this.loadingRange!=null&&!d.coversOffsetAndLimit(this.loadingRange.offset,this.loadingRange.limit))return;return this.markAsFinishedLoading(),this.set("cache",d)},b.accessor("toArray",b.prototype.toArray),b.accessor("offset","limit","totalCount",{get:E.Property.defaultAccessor.get,set:function(a,b){return E.Property.defaultAccessor.set.call(this,a,+b)}}),b.accessor("page",{get:b.prototype.page,set:function(a,b){return b=+b,this.set("offset",this.offsetFromPageAndLimit(b,this.get("limit"))),b}}),b.accessor("pageCount",b.prototype.pageCount),b}(E.Object),E.ModelPaginator=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return W(b,a),b.name="ModelPaginator",b.prototype.cachePadding=0,b.prototype.paddedOffset=function(a){return a-=this.cachePadding,a<0?0:a},b.prototype.paddedLimit=function(a){return a+this.cachePadding*2},b.prototype.loadItemsForOffsetAndLimit=function(a,b){var c,d,e,f,g=this;d=this.paramsForOffsetAndLimit(a,b),f=this.params;for(c in f)e=f[c],d[c]=e;return this.model.load(d,function(a,b){return a!=null?(g.markAsFinishedLoading(),g.fire("error",a)):g.updateCache(g.offsetFromParams(d),g.limitFromParams(d),b)})},b.prototype.paramsForOffsetAndLimit=function(a,b){return{offset:this.paddedOffset(a),limit:this.paddedLimit(b)}},b.prototype.offsetFromParams=function(a){return a.offset},b.prototype.limitFromParams=function(a){return a.limit},b}(E.Paginator),typeof define=="function"&&define("batman",[],function(){return E}),E.exportHelpers=function(a){var b,c,d,e;e=["mixin","unmixin","route","redirect","typeOf","redirect","setImmediate"];for(c=0,d=e.length;c<d;c++)b=e[c],a["$"+b]=E[b];return a},E.exportGlobals=function(){return E.exportHelpers(E.container)}}).call(this);